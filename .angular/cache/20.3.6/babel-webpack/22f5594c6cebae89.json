{"ast":null,"code":"import { EventEmitter, signal, computed, inject, effect } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SpectralMapComponent } from '../spectral-map/spectral-map.component';\nimport { GeoTriangulatorComponent } from '../geo-triangulator/geo-triangulator.component';\nimport { DeviceStateService } from '../../services/device-state.service';\nimport * as i0 from \"@angular/core\";\nconst _c0 = [\"waveformCanvas\"];\nexport let ScannerComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class ScannerComponent {\n    constructor() {\n      this.detection = new EventEmitter();\n      this.status = signal('CALIBRATING...', ...(ngDevMode ? [{\n        debugName: \"status\"\n      }] : []));\n      this.lastDetectionTime = 0;\n      this.animationFrameId = null;\n      this.history = [];\n      this.maxHistory = 200;\n      this.deviceState = inject(DeviceStateService);\n      this.statusColorClass = computed(() => {\n        const reading = this.deviceState.emfReading();\n        if (reading > 90) return 'text-red-500 animate-pulse drop-shadow-[0_0_8px_rgba(239,68,68,0.8)]';\n        if (reading > 75) return 'text-warning-400 drop-shadow-[0_0_5px_rgba(250,204,21,0.6)]';\n        if (reading > 40) return 'text-spectral-300';\n        return 'text-spectral-600';\n      }, ...(ngDevMode ? [{\n        debugName: \"statusColorClass\"\n      }] : []));\n      effect(() => {\n        const reading = this.deviceState.emfReading();\n        this.updateStatus(reading);\n        this.updateHistory(reading);\n        const detectionCooldown = 10000; // 10 seconds\n        const now = Date.now();\n        // Trigger a detection event if reading is critical and cooldown has passed\n        if (reading > 90 && now - this.lastDetectionTime > detectionCooldown) {\n          this.triggerDetection(reading);\n          this.lastDetectionTime = now;\n          // Reset EMF slightly to prevent immediate re-triggering\n          this.deviceState.emfReading.set(20);\n        }\n      });\n    }\n    ngAfterViewInit() {\n      this.startVisualizer();\n    }\n    ngOnDestroy() {\n      if (this.animationFrameId) {\n        cancelAnimationFrame(this.animationFrameId);\n      }\n    }\n    updateHistory(reading) {\n      this.history.push(reading);\n      if (this.history.length > this.maxHistory) {\n        this.history.shift();\n      }\n    }\n    startVisualizer() {\n      const canvas = this.canvasRef.nativeElement;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n      // Handle high-DPI displays\n      const dpr = window.devicePixelRatio || 1;\n      const rect = canvas.getBoundingClientRect();\n      canvas.width = rect.width * dpr;\n      canvas.height = rect.height * dpr;\n      ctx.scale(dpr, dpr);\n      const draw = () => {\n        if (!ctx) return;\n        const width = rect.width;\n        const height = rect.height;\n        // Clear with trail effect\n        ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; // Fade out effect\n        ctx.fillRect(0, 0, width, height);\n        // Grid Lines\n        this.drawGrid(ctx, width, height);\n        // Waveform\n        this.drawWaveform(ctx, width, height);\n        this.animationFrameId = requestAnimationFrame(draw);\n      };\n      draw();\n    }\n    drawGrid(ctx, width, height) {\n      ctx.strokeStyle = 'rgba(6, 182, 212, 0.1)'; // Spectral-500 very low opacity\n      ctx.lineWidth = 1;\n      ctx.beginPath();\n      // Vertical lines\n      for (let x = 0; x <= width; x += 40) {\n        ctx.moveTo(x, 0);\n        ctx.lineTo(x, height);\n      }\n      // Horizontal lines\n      for (let y = 0; y <= height; y += 40) {\n        ctx.moveTo(0, y);\n        ctx.lineTo(width, y);\n      }\n      ctx.stroke();\n    }\n    drawWaveform(ctx, width, height) {\n      if (this.history.length < 2) return;\n      ctx.beginPath();\n      ctx.lineWidth = 2;\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n      const stepX = width / this.maxHistory;\n      // Start from the end of logic\n      // We map 0-100 reading to height. \n      // 0 reading -> height (bottom), 100 reading -> 0 (top)\n      for (let i = 0; i < this.history.length; i++) {\n        const x = i * stepX;\n        const reading = this.history[i];\n        // Add some jitter for \"noise\" if reading is low\n        const noise = reading < 20 ? (Math.random() - 0.5) * 5 : 0;\n        const y = height - (reading + noise) / 100 * height;\n        if (i === 0) {\n          ctx.moveTo(x, y);\n        } else {\n          ctx.lineTo(x, y);\n        }\n      }\n      // Dynamic Color based on current reading\n      const currentReading = this.history[this.history.length - 1];\n      let strokeColor = '#22d3ee'; // spectral-400\n      if (currentReading > 75) strokeColor = '#facc15'; // warning\n      if (currentReading > 90) strokeColor = '#ef4444'; // critical\n      ctx.strokeStyle = strokeColor;\n      ctx.shadowBlur = 10;\n      ctx.shadowColor = strokeColor;\n      ctx.stroke();\n      ctx.shadowBlur = 0; // Reset\n    }\n    updateStatus(reading) {\n      if (reading < 10) this.status.set('SYSTEM NOMINAL');else if (reading < 40) this.status.set('TRACE ENERGY DETECTED');else if (reading < 75) this.status.set('MODERATE FIELD DISTURBANCE');else if (reading < 90) this.status.set('HIGH EMF WARNING');else this.status.set('!!! CRITICAL EVENT IMMINENT !!!');\n    }\n    triggerDetection(reading) {\n      let strength = 'weak';\n      if (reading > 98) strength = 'critical';else if (reading > 95) strength = 'strong';else if (reading > 90) strength = 'moderate';\n      this.detection.emit({\n        emf: parseFloat(reading.toFixed(2)),\n        strength\n      });\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function ScannerComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ScannerComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ScannerComponent,\n      selectors: [[\"app-scanner\"]],\n      viewQuery: function ScannerComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.canvasRef = _t.first);\n        }\n      },\n      outputs: {\n        detection: \"detection\"\n      },\n      decls: 33,\n      vars: 6,\n      consts: [[\"waveformCanvas\", \"\"], [1, \"relative\", \"flex\", \"flex-col\", \"h-full\", \"w-full\", \"overflow-hidden\"], [1, \"absolute\", \"inset-0\", \"z-0\"], [1, \"w-full\", \"h-full\"], [1, \"relative\", \"z-10\", \"flex\", \"flex-col\", \"h-full\", \"p-4\", \"justify-between\", \"pointer-events-none\"], [1, \"w-full\", \"flex\", \"flex-col\", \"items-center\", \"pt-4\"], [1, \"px-4\", \"py-1\", \"rounded-full\", \"bg-obsidian-900/80\", \"border\", \"border-spectral-500/30\", \"backdrop-blur-md\", \"shadow-lg\", \"shadow-spectral-500/10\"], [1, \"text-xs\", \"font-mono\", \"font-bold\", \"tracking-[0.2em]\", \"uppercase\"], [1, \"flex\", \"flex-col\", \"items-center\", \"justify-center\"], [1, \"absolute\", \"opacity-10\", \"animate-spin-slow\"], [\"width\", \"300\", \"height\", \"300\", \"viewBox\", \"0 0 100 100\", \"fill\", \"none\", 1, \"text-spectral-500\"], [\"cx\", \"50\", \"cy\", \"50\", \"r\", \"48\", \"stroke\", \"currentColor\", \"stroke-width\", \"0.5\", \"stroke-dasharray\", \"2 2\"], [\"cx\", \"50\", \"cy\", \"50\", \"r\", \"35\", \"stroke\", \"currentColor\", \"stroke-width\", \"0.5\"], [\"cx\", \"50\", \"cy\", \"50\", \"r\", \"20\", \"stroke\", \"currentColor\", \"stroke-width\", \"0.5\", \"stroke-dasharray\", \"4 2\"], [\"x1\", \"50\", \"y1\", \"0\", \"x2\", \"50\", \"y2\", \"100\", \"stroke\", \"currentColor\", \"stroke-width\", \"0.5\"], [\"x1\", \"0\", \"y1\", \"50\", \"x2\", \"100\", \"y2\", \"50\", \"stroke\", \"currentColor\", \"stroke-width\", \"0.5\"], [1, \"relative\", \"z-10\", \"text-center\"], [1, \"text-8xl\", \"font-mono\", \"font-bold\", \"text-transparent\", \"bg-clip-text\", \"bg-gradient-to-b\", \"from-spectral-100\", \"to-spectral-500\", \"drop-shadow-[0_0_15px_rgba(6,182,212,0.5)]\"], [1, \"text-xl\", \"font-mono\", \"text-spectral-400\", \"tracking-widest\", \"mt-2\"], [1, \"w-full\", \"flex\", \"gap-3\", \"pb-4\", \"pointer-events-auto\"], [1, \"glass-panel\", \"rounded-xl\", \"flex-1\", \"p-2\", \"h-32\", \"flex\", \"flex-col\", \"items-center\", \"justify-center\", \"overflow-hidden\", \"relative\", \"group\"], [1, \"absolute\", \"inset-0\", \"bg-spectral-500/5\", \"group-hover:bg-spectral-500/10\", \"transition-colors\"], [1, \"text-[0.6rem]\", \"text-spectral-600\", \"uppercase\", \"mb-1\", \"font-mono\", \"z-10\"], [1, \"w-full\", \"h-full\", 3, \"emfReading\"]],\n      template: function ScannerComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2);\n          i0.ɵɵelement(2, \"canvas\", 3, 0);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"div\", 4)(5, \"div\", 5)(6, \"div\", 6)(7, \"p\", 7);\n          i0.ɵɵtext(8);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(9, \"div\", 8)(10, \"div\", 9);\n          i0.ɵɵnamespaceSVG();\n          i0.ɵɵelementStart(11, \"svg\", 10);\n          i0.ɵɵelement(12, \"circle\", 11)(13, \"circle\", 12)(14, \"circle\", 13)(15, \"line\", 14)(16, \"line\", 15);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵnamespaceHTML();\n          i0.ɵɵelementStart(17, \"div\", 16)(18, \"h2\", 17);\n          i0.ɵɵtext(19);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"p\", 18);\n          i0.ɵɵtext(21, \"MICRO-TESLA\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(22, \"div\", 19)(23, \"div\", 20);\n          i0.ɵɵelement(24, \"div\", 21);\n          i0.ɵɵelementStart(25, \"p\", 22);\n          i0.ɵɵtext(26, \"Triangulation\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(27, \"app-geo-triangulator\", 23);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"div\", 20);\n          i0.ɵɵelement(29, \"div\", 21);\n          i0.ɵɵelementStart(30, \"p\", 22);\n          i0.ɵɵtext(31, \"Spectral Map\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(32, \"app-spectral-map\", 23);\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵclassMap(ctx.statusColorClass());\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate1(\" \", ctx.status(), \" \");\n          i0.ɵɵadvance(11);\n          i0.ɵɵtextInterpolate1(\" \", ctx.deviceState.emfReading().toFixed(1), \" \");\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"emfReading\", ctx.deviceState.emfReading());\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"emfReading\", ctx.deviceState.emfReading());\n        }\n      },\n      dependencies: [CommonModule, SpectralMapComponent, GeoTriangulatorComponent],\n      styles: [\".radial-gradient-scanner[_ngcontent-%COMP%]{background:radial-gradient(circle at center,var(--color-primary-800) 0%,transparent 60%);animation:_ngcontent-%COMP%_pulse 4s infinite ease-in-out}.noise-overlay-scanner[_ngcontent-%COMP%]{background-image:url('data:image/svg+xml,<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 800 800\\\"><filter id=\\\"noise\\\"><feTurbulence type=\\\"fractalNoise\\\" baseFrequency=\\\"0.65\\\" numOctaves=\\\"3\\\" stitchTiles=\\\"stitch\\\"/></filter><rect width=\\\"100%\\\" height=\\\"100%\\\" filter=\\\"url(%23noise)\\\"/></svg>');opacity:.1}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1);opacity:.2}50%{transform:scale(1.2);opacity:.3}}.glitch-effect[_ngcontent-%COMP%]{position:relative;display:inline-block}.glitch-effect[_ngcontent-%COMP%]:before, .glitch-effect[_ngcontent-%COMP%]:after{content:attr(data-text);position:absolute;top:0;left:0;width:100%;height:100%;background:var(--color-background);overflow:hidden}.glitch-effect[_ngcontent-%COMP%]:before{left:2px;text-shadow:-1px 0 red;animation:_ngcontent-%COMP%_glitch-anim-1 2s infinite linear reverse}.glitch-effect[_ngcontent-%COMP%]:after{left:-2px;text-shadow:-1px 0 blue;animation:_ngcontent-%COMP%_glitch-anim-2 2s infinite linear reverse}@keyframes _ngcontent-%COMP%_glitch-anim-1{0%,10%,12%,to{clip-path:inset(0 0 0 0)}10.5%{clip-path:inset(20px 0 80px 0)}11%{clip-path:inset(50px 0 30px 0)}11.5%{clip-path:inset(10px 0 90px 0)}}@keyframes _ngcontent-%COMP%_glitch-anim-2{0%,10%,12%,to{clip-path:inset(0 0 0 0)}10.5%{clip-path:inset(80px 0 10px 0)}11%{clip-path:inset(40px 0 20px 0)}11.5%{clip-path:inset(70px 0 5px 0)}}\"],\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return ScannerComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}