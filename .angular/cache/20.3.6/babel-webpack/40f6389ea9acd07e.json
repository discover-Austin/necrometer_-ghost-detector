{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/grand/necrometer_-ghost-detector-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { signal, inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { GeminiService } from '../../services/gemini.service';\nimport { VoiceRecorder } from 'capacitor-voice-recorder';\nimport { UpgradeService } from '../../services/upgrade.service';\nimport * as i0 from \"@angular/core\";\nconst _c0 = [\"waveformCanvas\"];\nfunction EvpComponent_Case_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"p\", 13);\n    i0.ɵɵtext(1, \"Press record to capture ambient audio.\");\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(2, \"p\", 14);\n    i0.ɵɵtext(3);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Analysis Cost: \", ctx_r0.analysisCost, \" NC\");\n  }\n}\nfunction EvpComponent_Case_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"p\", 8);\n    i0.ɵɵtext(1, \"RECORDING...\");\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction EvpComponent_Case_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 9);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵdomElementStart(1, \"svg\", 15);\n    i0.ɵɵdomElement(2, \"circle\", 16)(3, \"path\", 17);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵdomElementStart(4, \"p\", 18);\n    i0.ɵɵtext(5, \"ANALYZING STATIC...\");\n    i0.ɵɵdomElementEnd()();\n  }\n}\nfunction EvpComponent_Case_13_Conditional_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 19)(1, \"p\", 20);\n    i0.ɵɵtext(2, \"Deciphered Message:\");\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(3, \"p\", 21);\n    i0.ɵɵtext(4);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(5, \"p\", 22);\n    i0.ɵɵtext(6);\n    i0.ɵɵdomElementEnd()();\n  }\n  if (rf & 2) {\n    const result_r2 = ctx;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\\\"\", result_r2.transcription, \"\\\"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Analysis Confidence: \", (result_r2.confidence * 100).toFixed(0), \"%\");\n  }\n}\nfunction EvpComponent_Case_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵconditionalCreate(0, EvpComponent_Case_13_Conditional_0_Template, 7, 2, \"div\", 19);\n  }\n  if (rf & 2) {\n    let tmp_2_0;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵconditional((tmp_2_0 = ctx_r0.analysisResult()) ? 0 : -1, tmp_2_0);\n  }\n}\nfunction EvpComponent_Conditional_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"p\", 10);\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.error());\n  }\n}\nfunction EvpComponent_Conditional_16_Conditional_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵdomElementStart(0, \"svg\", 25);\n    i0.ɵɵdomElement(1, \"path\", 27);\n    i0.ɵɵdomElementEnd();\n  }\n}\nfunction EvpComponent_Conditional_16_Conditional_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElement(0, \"div\", 26);\n  }\n}\nfunction EvpComponent_Conditional_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵdomElementStart(0, \"button\", 23);\n    i0.ɵɵdomListener(\"click\", function EvpComponent_Conditional_16_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.toggleRecording());\n    });\n    i0.ɵɵdomElementStart(1, \"div\", 24);\n    i0.ɵɵconditionalCreate(2, EvpComponent_Conditional_16_Conditional_2_Template, 2, 0, \":svg:svg\", 25)(3, EvpComponent_Conditional_16_Conditional_3_Template, 1, 0, \"div\", 26);\n    i0.ɵɵdomElementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"bg-red-600\", ctx_r0.state() === \"idle\")(\"bg-gray-400\", ctx_r0.state() === \"recording\");\n    i0.ɵɵadvance();\n    i0.ɵɵclassProp(\"bg-red-500\", ctx_r0.state() === \"idle\")(\"bg-red-600\", ctx_r0.state() === \"recording\")(\"animate-pulse\", ctx_r0.state() === \"recording\");\n    i0.ɵɵadvance();\n    i0.ɵɵconditional(ctx_r0.state() === \"idle\" ? 2 : 3);\n  }\n}\nfunction EvpComponent_Conditional_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵdomElementStart(0, \"button\", 28);\n    i0.ɵɵdomListener(\"click\", function EvpComponent_Conditional_17_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.reset());\n    });\n    i0.ɵɵtext(1, \" Record Again \");\n    i0.ɵɵdomElementEnd();\n  }\n}\nexport let EvpComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class EvpComponent {\n    constructor() {\n      this.state = signal('idle', ...(ngDevMode ? [{\n        debugName: \"state\"\n      }] : []));\n      this.analysisResult = signal(null, ...(ngDevMode ? [{\n        debugName: \"analysisResult\"\n      }] : []));\n      this.error = signal(null, ...(ngDevMode ? [{\n        debugName: \"error\"\n      }] : []));\n      this.geminiService = inject(GeminiService);\n      this.upgradeService = inject(UpgradeService);\n      this.animationFrameId = null;\n      this.analysisCost = 2;\n    }\n    ngAfterViewInit() {\n      this.drawSilence();\n    }\n    toggleRecording() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.state() === 'recording') {\n          yield _this.stopRecording();\n        } else {\n          yield _this.startRecording();\n        }\n      })();\n    }\n    startRecording() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const permission = yield VoiceRecorder.requestAudioRecordingPermission();\n          if (!permission.value) {\n            _this2.error.set(\"Microphone access is required. Please enable permissions.\");\n            return;\n          }\n          yield VoiceRecorder.startRecording();\n          _this2.state.set('recording');\n          _this2.error.set(null);\n          _this2.drawSimulatedWaveform();\n        } catch (err) {\n          console.error(\"Microphone access denied:\", err);\n          _this2.error.set(\"Failed to start recording. Ensure permissions are enabled.\");\n          _this2.state.set('idle');\n        }\n      })();\n    }\n    stopRecording() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (_this3.state() !== 'recording') return;\n        if (_this3.animationFrameId) {\n          cancelAnimationFrame(_this3.animationFrameId);\n          _this3.animationFrameId = null;\n        }\n        try {\n          const result = yield VoiceRecorder.stopRecording();\n          if (result.value) {\n            _this3.analyze();\n          } else {\n            _this3.error.set(\"Recording failed to produce data.\");\n            _this3.state.set('idle');\n          }\n        } catch (err) {\n          console.error(\"Error stopping recording\", err);\n          _this3.error.set(\"An error occurred while stopping the recording.\");\n          _this3.state.set('idle');\n        }\n      })();\n    }\n    analyze() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4.upgradeService.spendCredits(_this4.analysisCost)) {\n          _this4.error.set(`Insufficient Credits. Analysis requires ${_this4.analysisCost} NC.`);\n          _this4.state.set('idle');\n          _this4.drawSilence();\n          return;\n        }\n        _this4.state.set('analyzing');\n        _this4.drawSilence();\n        try {\n          const result = yield _this4.geminiService.getEVPMessage();\n          _this4.analysisResult.set(result);\n          _this4.state.set('result');\n        } catch (err) {\n          _this4.error.set(\"AI analysis failed. The connection is unstable.\");\n          _this4.state.set('idle');\n        }\n      })();\n    }\n    reset() {\n      this.state.set('idle');\n      this.analysisResult.set(null);\n      this.error.set(null);\n      this.drawSilence();\n    }\n    drawSimulatedWaveform() {\n      const canvas = this.canvasRef.nativeElement;\n      const ctx = canvas.getContext('2d');\n      const {\n        width,\n        height\n      } = canvas;\n      const midY = height / 2;\n      let time = 0;\n      const draw = () => {\n        time += 0.05;\n        ctx.fillStyle = 'rgb(0, 0, 0)';\n        ctx.fillRect(0, 0, width, height);\n        ctx.lineWidth = 2;\n        ctx.strokeStyle = 'rgb(52, 211, 153)';\n        ctx.beginPath();\n        ctx.moveTo(0, midY);\n        for (let x = 0; x < width; x++) {\n          const noise = (Math.sin(x * 0.1 + time) + Math.sin(x * 0.25 + time * 2) * 0.5) * (Math.random() * 5 + 5);\n          const y = midY + noise;\n          ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n        this.animationFrameId = requestAnimationFrame(draw);\n      };\n      draw();\n    }\n    drawSilence() {\n      if (!this.canvasRef) return;\n      const canvas = this.canvasRef.nativeElement;\n      const ctx = canvas.getContext('2d');\n      const {\n        width,\n        height\n      } = canvas;\n      ctx.fillStyle = 'rgb(0, 0, 0)';\n      ctx.fillRect(0, 0, width, height);\n      ctx.lineWidth = 2;\n      ctx.strokeStyle = 'rgb(52, 211, 153)';\n      ctx.beginPath();\n      ctx.moveTo(0, height / 2);\n      ctx.lineTo(width, height / 2);\n      ctx.stroke();\n    }\n    ngOnDestroy() {\n      if (this.state() === 'recording') {\n        VoiceRecorder.stopRecording();\n      }\n      if (this.animationFrameId) {\n        cancelAnimationFrame(this.animationFrameId);\n      }\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function EvpComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || EvpComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EvpComponent,\n      selectors: [[\"app-evp\"]],\n      viewQuery: function EvpComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.canvasRef = _t.first);\n        }\n      },\n      decls: 18,\n      vars: 3,\n      consts: [[\"waveformCanvas\", \"\"], [1, \"flex\", \"flex-col\", \"h-full\", \"items-center\", \"justify-between\", \"text-center\", \"p-4\", \"rounded-lg\", \"bg-gray-800/20\", \"border-2\", \"border-[var(--color-primary-500)]/20\"], [1, \"w-full\"], [1, \"text-xl\", \"font-bold\", \"text-[var(--color-primary-400)]\", \"mb-4\", \"border-b\", \"border-[var(--color-primary-500)]/20\", \"pb-2\"], [1, \"text-sm\", \"text-gray-400\", \"mb-4\"], [1, \"w-full\", \"h-32\", \"bg-black\", \"rounded-md\", \"border-2\", \"border-[var(--color-primary-900)]\", \"overflow-hidden\"], [1, \"w-full\", \"h-full\"], [1, \"w-full\", \"min-h-[120px]\", \"flex\", \"flex-col\", \"items-center\", \"justify-center\"], [1, \"text-red-400\", \"animate-pulse\", \"font-bold\", \"text-lg\"], [1, \"flex\", \"flex-col\", \"items-center\", \"text-teal-300\"], [1, \"text-red-400\", \"text-sm\", \"mt-2\", \"p-2\", \"bg-red-900/50\", \"rounded-md\"], [1, \"w-20\", \"h-20\", \"rounded-full\", \"transition-all\", \"duration-300\", \"flex\", \"items-center\", \"justify-center\", \"mx-auto\", 3, \"bg-red-600\", \"bg-gray-400\"], [1, \"bg-[var(--color-primary-600)]\", \"hover:bg-[var(--color-primary-500)]\", \"text-white\", \"font-bold\", \"py-3\", \"px-6\", \"rounded-lg\", \"transition-colors\"], [1, \"text-gray-400\"], [1, \"text-xs\", \"text-yellow-400\", \"mt-1\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"fill\", \"none\", \"viewBox\", \"0 0 24 24\", 1, \"animate-spin\", \"h-8\", \"w-8\", \"mb-2\"], [\"cx\", \"12\", \"cy\", \"12\", \"r\", \"10\", \"stroke\", \"currentColor\", \"stroke-width\", \"4\", 1, \"opacity-25\"], [\"fill\", \"currentColor\", \"d\", \"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\", 1, \"opacity-75\"], [1, \"font-bold\", \"text-lg\"], [1, \"text-left\", \"w-full\", \"p-3\", \"bg-black/30\", \"rounded-md\", \"border\", \"border-gray-700\"], [1, \"text-sm\", \"text-gray-400\"], [1, \"text-2xl\", \"text-[var(--color-primary-300)]\", \"font-mono\", \"tracking-widest\", \"my-1\"], [1, \"text-xs\", \"text-gray-500\"], [1, \"w-20\", \"h-20\", \"rounded-full\", \"transition-all\", \"duration-300\", \"flex\", \"items-center\", \"justify-center\", \"mx-auto\", 3, \"click\"], [1, \"w-16\", \"h-16\", \"rounded-full\", \"flex\", \"items-center\", \"justify-center\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"viewBox\", \"0 0 20 20\", \"fill\", \"currentColor\", 1, \"w-8\", \"h-8\", \"text-white\"], [1, \"w-6\", \"h-6\", \"bg-white\", \"rounded-sm\"], [\"fill-rule\", \"evenodd\", \"d\", \"M10 18a8 8 0 100-16 8 8 0 000 16z\", \"clip-rule\", \"evenodd\"], [1, \"bg-[var(--color-primary-600)]\", \"hover:bg-[var(--color-primary-500)]\", \"text-white\", \"font-bold\", \"py-3\", \"px-6\", \"rounded-lg\", \"transition-colors\", 3, \"click\"]],\n      template: function EvpComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵdomElementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"h2\", 3);\n          i0.ɵɵtext(3, \"EVP Recorder\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(4, \"p\", 4);\n          i0.ɵɵtext(5, \"Capture and analyze Electronic Voice Phenomena.\");\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵdomElementStart(6, \"div\", 5);\n          i0.ɵɵdomElement(7, \"canvas\", 6, 0);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(9, \"div\", 7);\n          i0.ɵɵconditionalCreate(10, EvpComponent_Case_10_Template, 4, 1)(11, EvpComponent_Case_11_Template, 2, 0, \"p\", 8)(12, EvpComponent_Case_12_Template, 6, 0, \"div\", 9)(13, EvpComponent_Case_13_Template, 1, 1);\n          i0.ɵɵconditionalCreate(14, EvpComponent_Conditional_14_Template, 2, 1, \"p\", 10);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(15, \"div\", 2);\n          i0.ɵɵconditionalCreate(16, EvpComponent_Conditional_16_Template, 4, 11, \"button\", 11)(17, EvpComponent_Conditional_17_Template, 2, 0, \"button\", 12);\n          i0.ɵɵdomElementEnd()();\n        }\n        if (rf & 2) {\n          let tmp_1_0;\n          i0.ɵɵadvance(10);\n          i0.ɵɵconditional((tmp_1_0 = ctx.state()) === \"idle\" ? 10 : tmp_1_0 === \"recording\" ? 11 : tmp_1_0 === \"analyzing\" ? 12 : tmp_1_0 === \"result\" ? 13 : -1);\n          i0.ɵɵadvance(4);\n          i0.ɵɵconditional(ctx.error() ? 14 : -1);\n          i0.ɵɵadvance(2);\n          i0.ɵɵconditional(ctx.state() === \"idle\" || ctx.state() === \"recording\" ? 16 : 17);\n        }\n      },\n      dependencies: [CommonModule],\n      encapsulation: 2,\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return EvpComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}