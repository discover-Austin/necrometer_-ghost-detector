{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/grand/necrometer_-ghost-detector-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { inject, signal, effect } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DeviceStateService } from '../../services/device-state.service';\nimport { SensorService } from '../../services/sensor.service';\nimport { UpgradeService } from '../../services/upgrade.service';\nimport { GeminiService } from '../../services/gemini.service';\nimport { CameraPreview } from '@capacitor-community/camera-preview';\nimport { App } from '@capacitor/app';\nimport { AudioService } from '../../services/audio.service';\nimport * as i0 from \"@angular/core\";\nfunction VisionComponent_Conditional_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵdomElementStart(0, \"div\", 1);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵdomElementStart(1, \"svg\", 3);\n    i0.ɵɵdomElement(2, \"path\", 4);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵdomElementStart(3, \"h2\", 5);\n    i0.ɵɵtext(4, \"Camera Access Required\");\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(5, \"p\", 6);\n    i0.ɵɵtext(6);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(7, \"button\", 7);\n    i0.ɵɵdomListener(\"click\", function VisionComponent_Conditional_1_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.startCamera());\n    });\n    i0.ɵɵtext(8, \" Retry \");\n    i0.ɵɵdomElementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r1.cameraPermissionError());\n  }\n}\nexport let VisionComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class VisionComponent {\n    constructor() {\n      this.deviceState = inject(DeviceStateService);\n      this.sensorService = inject(SensorService);\n      this.upgradeService = inject(UpgradeService);\n      this.geminiService = inject(GeminiService);\n      this.audioService = inject(AudioService);\n      this.arEntities = signal([], ...(ngDevMode ? [{\n        debugName: \"arEntities\"\n      }] : []));\n      this.targetedEntity = signal(null, ...(ngDevMode ? [{\n        debugName: \"targetedEntity\"\n      }] : []));\n      this.currentTime = signal(Date.now(), ...(ngDevMode ? [{\n        debugName: \"currentTime\"\n      }] : []));\n      // Camera state\n      this.isCameraActive = false;\n      this.cameraPermissionError = signal(null, ...(ngDevMode ? [{\n        debugName: \"cameraPermissionError\"\n      }] : []));\n      this.appStateListener = null;\n      // State for environmental scanning\n      this.isScanningEnvironment = signal(false, ...(ngDevMode ? [{\n        debugName: \"isScanningEnvironment\"\n      }] : []));\n      this.scanError = signal(null, ...(ngDevMode ? [{\n        debugName: \"scanError\"\n      }] : []));\n      this.sceneObjects = signal([], ...(ngDevMode ? [{\n        debugName: \"sceneObjects\"\n      }] : []));\n      this.scanCost = 5;\n      this.animationFrameId = null;\n      effect(() => {\n        this.currentTime();\n      });\n    }\n    ngOnInit() {\n      this.startCamera();\n      this.appStateListener = App.addListener('appStateChange', ({\n        isActive\n      }) => {\n        if (isActive && this.cameraPermissionError() && !this.isCameraActive) {\n          this.startCamera();\n        }\n      });\n    }\n    ngOnDestroy() {\n      this.stopCamera();\n      if (this.appStateListener) {\n        this.appStateListener.remove();\n      }\n    }\n    startCamera() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.isCameraActive) return;\n        const attemptStart = /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (position) {\n            yield CameraPreview.start({\n              position,\n              toBack: true,\n              parent: 'vision-camera-container',\n              className: 'camera-preview-class'\n            });\n          });\n          return function attemptStart(_x) {\n            return _ref.apply(this, arguments);\n          };\n        }();\n        try {\n          yield attemptStart('rear');\n          _this.isCameraActive = true;\n          _this.cameraPermissionError.set(null);\n        } catch (rearError) {\n          const rearErrorMessage = rearError instanceof Error ? rearError.message : String(rearError);\n          if (rearErrorMessage.toLowerCase().includes('requested device not found')) {\n            console.warn(\"Rear camera not found, attempting front camera.\");\n            try {\n              yield attemptStart('front');\n              _this.isCameraActive = true;\n              _this.cameraPermissionError.set(null);\n            } catch (frontError) {\n              const frontErrorMessage = frontError instanceof Error ? frontError.message : String(frontError);\n              if (frontErrorMessage.toLowerCase().includes('requested device not found')) {\n                console.warn(\"No camera device found (tried rear and front). Proceeding without camera preview.\");\n                _this.isCameraActive = false;\n                _this.cameraPermissionError.set(null);\n              } else {\n                console.error(\"Error starting front camera preview:\", frontError);\n                _this.handleCameraError(frontError);\n              }\n            }\n          } else {\n            console.error(\"Error starting rear camera preview:\", rearError);\n            _this.handleCameraError(rearError);\n          }\n        }\n      })();\n    }\n    handleCameraError(err) {\n      const errorMessage = err instanceof Error ? err.message : String(err);\n      if (errorMessage.toLowerCase().includes('permission')) {\n        this.cameraPermissionError.set(\"Camera permission has been denied. To use Vision, please enable camera access in your device or browser's app settings.\");\n      } else if (errorMessage.toLowerCase().includes('requested device not found')) {\n        this.cameraPermissionError.set(\"No suitable camera was found on your device. The Vision feature requires a camera to function.\");\n      } else {\n        this.cameraPermissionError.set(\"Failed to start the camera. Please ensure permissions are granted and try restarting the app.\");\n      }\n    }\n    stopCamera() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this2.isCameraActive) return;\n        _this2.isCameraActive = false;\n        try {\n          yield CameraPreview.stop();\n        } catch (e) {\n          console.warn(\"Could not stop camera preview\", e);\n        }\n      })();\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function VisionComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || VisionComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: VisionComponent,\n      selectors: [[\"app-vision\"]],\n      inputs: {\n        detections: \"detections\"\n      },\n      decls: 3,\n      vars: 1,\n      consts: [[\"id\", \"vision-camera-container\", 1, \"relative\", \"w-full\", \"h-full\", \"bg-transparent\"], [1, \"absolute\", \"inset-0\", \"z-50\", \"flex\", \"flex-col\", \"items-center\", \"justify-center\", \"bg-black/90\", \"p-8\", \"text-center\"], [1, \"absolute\", \"inset-0\", \"z-10\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke-width\", \"1.5\", \"stroke\", \"currentColor\", 1, \"w-16\", \"h-16\", \"text-red-500\", \"mb-4\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z\"], [1, \"text-2xl\", \"font-bold\", \"text-red-400\", \"mb-2\"], [1, \"text-gray-300\", \"mb-6\"], [1, \"px-6\", \"py-3\", \"bg-[var(--color-primary-600)]\", \"hover:bg-[var(--color-primary-500)]\", \"text-white\", \"font-bold\", \"rounded-lg\", \"transition-colors\", 3, \"click\"]],\n      template: function VisionComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵdomElementStart(0, \"div\", 0);\n          i0.ɵɵconditionalCreate(1, VisionComponent_Conditional_1_Template, 9, 1, \"div\", 1);\n          i0.ɵɵdomElement(2, \"div\", 2);\n          i0.ɵɵdomElementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance();\n          i0.ɵɵconditional(ctx.cameraPermissionError() ? 1 : -1);\n        }\n      },\n      dependencies: [CommonModule],\n      styles: [\"[_ngcontent-%COMP%]:root{--glitch-speed: 1.5s;--waver-speed: 10s;--waver-intensity: 1deg;--aberration-offset: 1px}.ar-container[_ngcontent-%COMP%]{overflow:hidden}.scanline[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:2px;height:100%;background:linear-gradient(to bottom,rgba(110,231,183,0) 0%,var(--color-primary-400) 50%,rgba(110,231,183,0) 100%);box-shadow:0 0 10px var(--color-primary-400);animation:_ngcontent-%COMP%_scan-anim 4s linear infinite;z-index:1}@keyframes _ngcontent-%COMP%_scan-anim{0%{transform:translate(-10px)}to{transform:translate(calc(100vw - 2px))}}.entity-glyph-container[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%);width:12vmin;height:18vmin;max-width:80px;max-height:120px;will-change:transform,filter,opacity,top,left;display:flex;align-items:center;justify-content:center;transition:transform .2s ease-out;animation:_ngcontent-%COMP%_waver var(--waver-speed) infinite ease-in-out}.entity-glyph-container[_ngcontent-%COMP%]:not(.contained){--glitch-speed: calc(1.5s - (var(--distortion-level, 0) * .14s));--waver-speed: calc(10s - (var(--distortion-level, 0) * .9s));--waver-intensity: calc(1deg + (var(--distortion-level, 0) * .6deg));--aberration-offset: calc(1px + (var(--distortion-level, 0) * .7px))}.entity-glyph-container.targeted[_ngcontent-%COMP%]:not(.contained){transform:translate(-50%,-50%) scale(1.15);--waver-intensity: calc(2deg + (var(--distortion-level, 0) * .7deg));--aberration-offset: calc(2px + (var(--distortion-level, 0) * .8px))}.entity-glyph-container.critical-glitch[_ngcontent-%COMP%]:not(.contained){animation:_ngcontent-%COMP%_glitch-transform .8s cubic-bezier(.25,.46,.45,.94) both infinite,_ngcontent-%COMP%_waver var(--waver-speed) infinite ease-in-out}.entity-glyph[_ngcontent-%COMP%]{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center;filter:drop-shadow(0 0 5px var(--color-primary-500));opacity:.8;transition:filter .3s ease-in-out,opacity .3s ease-in-out}.entity-humanoid[_ngcontent-%COMP%]{width:90%;height:100%;mix-blend-mode:screen;filter:drop-shadow(0 6px 12px rgba(0,0,0,.45));transition:opacity .2s ease,transform .2s ease}.entity-humanoid[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]{transform-origin:0 0;transition:transform .12s linear}.entity-humanoid[_ngcontent-%COMP%]   ellipse[_ngcontent-%COMP%], .entity-humanoid[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%], .entity-humanoid[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{transition:transform .12s linear,opacity .12s linear}.entity-shadow[_ngcontent-%COMP%]{position:absolute;width:50%;height:12%;background:radial-gradient(ellipse at center,#0009,#0000002e 40%,#0000);bottom:8%;left:50%;transform:translate(-50%);border-radius:50%;transition:opacity .15s ease,transform .2s ease;z-index:-1}.entity-glyph-container.occluded[_ngcontent-%COMP%]{opacity:.18;filter:blur(.6px) saturate(.6);transform-origin:center bottom}.entity-glyph-container[_ngcontent-%COMP%]{--bob-offset: 0px}.entity-glyph-container[_ngcontent-%COMP%]   .entity-humanoid[_ngcontent-%COMP%]{transform:translateY(var(--bob-offset))}.entity-glyph-container.targeted[_ngcontent-%COMP%]   .entity-humanoid[_ngcontent-%COMP%]{filter:drop-shadow(0 10px 18px rgba(255,120,120,.12)) saturate(1.1)}.entity-glyph-container.targeted[_ngcontent-%COMP%]:not(.contained)   .entity-glyph[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-glow-targeted 1.2s infinite ease-in-out}@keyframes _ngcontent-%COMP%_ripple-effect{0%{box-shadow:0 0 #34d399b3}to{box-shadow:0 0 0 20px #34d39900}}.entity-glyph-container.interacting[_ngcontent-%COMP%]   .entity-glyph[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_ripple-effect .4s ease-out}.entity-glyph[_ngcontent-%COMP%]:before, .entity-glyph[_ngcontent-%COMP%]:after{content:\\\"\\\";position:absolute;inset:0;background-image:inherit;background-size:contain;background-repeat:no-repeat;background-position:center;mix-blend-mode:screen;transition:transform .2s ease-out;opacity:.9}.entity-glyph[_ngcontent-%COMP%]:before{background-color:red;transform:translate(var(--aberration-offset))}.entity-glyph[_ngcontent-%COMP%]:after{background-color:#0ff;transform:translate(calc(-1 * var(--aberration-offset)))}.entity-glyph-container.critical-glitch[_ngcontent-%COMP%]   .entity-glyph[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_glitch var(--glitch-speed) infinite}.entity-glyph-container.critical-glitch[_ngcontent-%COMP%]   .entity-glyph[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_glitch var(--glitch-speed) reverse infinite}.containment-field[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:120%;height:120%;border:2px solid rgba(59,130,246,.8);border-radius:50%;box-shadow:0 0 15px #3b82f6b3 inset,0 0 10px #3b82f680;animation:_ngcontent-%COMP%_pulse-contain 3s infinite ease-in-out}@keyframes _ngcontent-%COMP%_pulse-contain{0%,to{transform:translate(-50%,-50%) scale(1);opacity:.8}50%{transform:translate(-50%,-50%) scale(1.05);opacity:1}}.crosshair-hud[_ngcontent-%COMP%]{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);width:150px;height:150px;display:flex;align-items:center;justify-content:center;color:var(--color-primary-400)}.crosshair-default[_ngcontent-%COMP%], .crosshair-lock[_ngcontent-%COMP%]{width:100%;height:100%;stroke:currentColor;stroke-width:2;fill:none;transition:opacity .3s ease;position:absolute}.crosshair-lock[_ngcontent-%COMP%]{color:#f87171;animation:_ngcontent-%COMP%_lock-on .3s ease-out forwards}@keyframes _ngcontent-%COMP%_lock-on{0%{transform:scale(1.5);opacity:0}to{transform:scale(1);opacity:1}}.target-info[_ngcontent-%COMP%]{position:absolute;bottom:-60px;width:200px;text-align:center;animation:_ngcontent-%COMP%_info-fade-in .4s .1s ease-out forwards;opacity:0;background:#0009;padding:8px;border-radius:4px;border:1px solid rgba(248,113,113,.4);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.target-name[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;color:#f87171;text-transform:uppercase;letter-spacing:.1em}.target-instability[_ngcontent-%COMP%]{margin-top:4px}.target-instability[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.6rem;letter-spacing:.05em;color:#fca5a5;margin-bottom:2px}.instability-bar[_ngcontent-%COMP%]{width:100%;height:6px;background:#ffffff1a;border:1px solid rgba(248,113,113,.3);border-radius:2px;padding:1px}.instability-fill[_ngcontent-%COMP%]{height:100%;background:#ef4444;border-radius:1px;transition:width .3s ease}@keyframes _ngcontent-%COMP%_info-fade-in{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_waver{0%,to{transform:translate(-50%,-50%) rotate(var(--waver-intensity))}50%{transform:translate(-50%,-50%) rotate(calc(-1 * var(--waver-intensity)))}}@keyframes _ngcontent-%COMP%_glitch{2%,64%{transform:translate(var(--aberration-offset))}65%{transform:translate(calc(-1 * var(--aberration-offset)))}}@keyframes _ngcontent-%COMP%_pulse-glow-targeted{0%,to{filter:drop-shadow(0 0 8px rgba(248,113,113,.7))}50%{filter:drop-shadow(0 0 20px rgba(248,113,113,1))}}@keyframes _ngcontent-%COMP%_glitch-transform{0%{clip-path:inset(0 0 0 0)}5%{clip-path:inset(10% 0 85% 0)}10%{clip-path:inset(90% 0 1% 0)}15%{clip-path:inset(30% 0 50% 0)}20%{clip-path:inset(0 0 0 0)}80%{clip-path:inset(0 0 0 0)}85%{clip-path:inset(80% 0 5% 0)}90%{clip-path:inset(5% 0 92% 0)}95%{clip-path:inset(40% 0 40% 0)}to{clip-path:inset(0 0 0 0)}}.scene-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2}.scene-polyline[_ngcontent-%COMP%]{fill:none;stroke:var(--color-primary-400);stroke-width:.5;stroke-linecap:round;stroke-linejoin:round;filter:drop-shadow(0 0 3px var(--color-primary-400));stroke-dasharray:1000;stroke-dashoffset:1000;animation:_ngcontent-%COMP%_draw-line 2.5s ease-out forwards,_ngcontent-%COMP%_pulse-line 4s 2.5s infinite ease-in-out}@keyframes _ngcontent-%COMP%_draw-line{to{stroke-dashoffset:0}}@keyframes _ngcontent-%COMP%_pulse-line{0%,to{opacity:.8}50%{opacity:.4}}.scan-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#064e3bcc;color:var(--color-primary-300);border:1px solid var(--color-primary-600);border-radius:8px;font-weight:700;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);transition:all .2s ease-in-out;cursor:pointer}.scan-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--color-primary-700);color:#fff;box-shadow:0 0 15px var(--color-primary-500)}.scan-button[_ngcontent-%COMP%]:disabled{background-color:#374151b3;color:#9ca3af;cursor:not-allowed}.scan-error-toast[_ngcontent-%COMP%]{background-color:#7f1d1de6;color:#fca5a5;padding:8px 12px;border-radius:6px;font-size:.875rem;font-weight:500;border:1px solid rgb(153,27,27);animation:_ngcontent-%COMP%_fade-in-out 4s ease-in-out forwards}@keyframes _ngcontent-%COMP%_fade-in-out{0%,to{opacity:0;transform:translateY(10px)}10%,90%{opacity:1;transform:translateY(0)}}.web-preview-container[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;width:160px;height:120px;background:#00000073;border:1px solid rgba(255,255,255,.08);border-radius:8px;overflow:hidden;display:none;z-index:30;pointer-events:auto}.web-preview-container.active[_ngcontent-%COMP%]{display:block}.web-preview-video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;background:#000}.web-preview-label[_ngcontent-%COMP%]{position:absolute;bottom:4px;left:6px;font-size:10px;color:#ffffffe6;background:#00000059;padding:2px 6px;border-radius:4px}.modal-backdrop[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0009}.modal-card[_ngcontent-%COMP%]{position:relative;width:90%;max-width:420px;background:#0a0a0af2;border-radius:10px;padding:18px;box-shadow:0 10px 30px #0009;color:#fff;z-index:60}.modal-title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}.modal-body[_ngcontent-%COMP%]{font-size:.95rem;color:#ffffffe6;margin-bottom:12px}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}\"],\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return VisionComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}