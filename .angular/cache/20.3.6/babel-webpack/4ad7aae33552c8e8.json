{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/grand/necrometer_-ghost-detector-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { signal } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nexport let SensorService = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class SensorService {\n    constructor() {\n      this.orientation = signal(null, ...(ngDevMode ? [{\n        debugName: \"orientation\"\n      }] : []));\n      this.motion = signal(null, ...(ngDevMode ? [{\n        debugName: \"motion\"\n      }] : []));\n      this.hasPermissions = signal(false, ...(ngDevMode ? [{\n        debugName: \"hasPermissions\"\n      }] : []));\n      // Using arrow functions to preserve `this` context in event handlers\n      this.handleOrientation = event => {\n        if (event.alpha !== null && event.beta !== null && event.gamma !== null) {\n          this.orientation.set({\n            alpha: event.alpha,\n            beta: event.beta,\n            gamma: event.gamma\n          });\n        }\n      };\n      this.handleMotion = event => {\n        if (event.accelerationIncludingGravity?.x) {\n          this.motion.set({\n            x: event.accelerationIncludingGravity.x,\n            y: event.accelerationIncludingGravity.y,\n            z: event.accelerationIncludingGravity.z\n          });\n        }\n      };\n    }\n    start() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (typeof window === 'undefined' || typeof DeviceOrientationEvent === 'undefined') {\n          console.warn('Device Orientation API not supported.');\n          return;\n        }\n        // For iOS 13+ we need to request permission\n        if (typeof DeviceOrientationEvent.requestPermission === 'function') {\n          try {\n            const permissionState = yield DeviceOrientationEvent.requestPermission();\n            if (permissionState === 'granted') {\n              _this.hasPermissions.set(true);\n            } else {\n              console.warn('Permission for Device Orientation not granted.');\n              return;\n            }\n          } catch (error) {\n            console.error('Error requesting device orientation permission:', error);\n            return;\n          }\n        } else {\n          // For other browsers, permission is often granted by default or handled differently\n          _this.hasPermissions.set(true);\n        }\n        if (_this.hasPermissions()) {\n          window.addEventListener('deviceorientation', _this.handleOrientation, true);\n          window.addEventListener('devicemotion', _this.handleMotion, true);\n        }\n      })();\n    }\n    stop() {\n      if (typeof window !== 'undefined') {\n        window.removeEventListener('deviceorientation', this.handleOrientation, true);\n        window.removeEventListener('devicemotion', this.handleMotion, true);\n      }\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function SensorService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || SensorService)();\n    }, this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: SensorService,\n      factory: SensorService.ɵfac,\n      providedIn: 'root'\n    }));\n  }\n  _staticBlock();\n  return SensorService;\n})();","map":{"version":3,"names":["signal","SensorService","_staticBlock","constructor","orientation","ngDevMode","debugName","motion","hasPermissions","handleOrientation","event","alpha","beta","gamma","set","handleMotion","accelerationIncludingGravity","x","y","z","start","_this","_asyncToGenerator","window","DeviceOrientationEvent","console","warn","requestPermission","permissionState","error","addEventListener","stop","removeEventListener","_","factory","ɵfac","providedIn"],"sources":["C:\\Users\\grand\\necrometer_-ghost-detector-1\\src\\services\\sensor.service.ts"],"sourcesContent":["import { Injectable, signal } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class SensorService {\r\n  orientation = signal<{ alpha: number; beta: number; gamma: number } | null>(null);\r\n  motion = signal<{ x: number; y: number; z: number } | null>(null);\r\n\r\n  private hasPermissions = signal(false);\r\n\r\n  // Using arrow functions to preserve `this` context in event handlers\r\n  private handleOrientation = (event: DeviceOrientationEvent) => {\r\n    if (event.alpha !== null && event.beta !== null && event.gamma !== null) {\r\n      this.orientation.set({ alpha: event.alpha, beta: event.beta, gamma: event.gamma });\r\n    }\r\n  };\r\n\r\n  private handleMotion = (event: DeviceMotionEvent) => {\r\n    if (event.accelerationIncludingGravity?.x) {\r\n      this.motion.set({\r\n        x: event.accelerationIncludingGravity.x,\r\n        y: event.accelerationIncludingGravity.y!,\r\n        z: event.accelerationIncludingGravity.z!,\r\n      });\r\n    }\r\n  };\r\n\r\n  async start(): Promise<void> {\r\n    if (typeof window === 'undefined' || typeof DeviceOrientationEvent === 'undefined') {\r\n      console.warn('Device Orientation API not supported.');\r\n      return;\r\n    }\r\n\r\n    // For iOS 13+ we need to request permission\r\n    if (typeof (DeviceOrientationEvent as any).requestPermission === 'function') {\r\n      try {\r\n        const permissionState = await (DeviceOrientationEvent as any).requestPermission();\r\n        if (permissionState === 'granted') {\r\n          this.hasPermissions.set(true);\r\n        } else {\r\n          console.warn('Permission for Device Orientation not granted.');\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error requesting device orientation permission:', error);\r\n        return;\r\n      }\r\n    } else {\r\n      // For other browsers, permission is often granted by default or handled differently\r\n      this.hasPermissions.set(true);\r\n    }\r\n\r\n    if (this.hasPermissions()) {\r\n        window.addEventListener('deviceorientation', this.handleOrientation, true);\r\n        window.addEventListener('devicemotion', this.handleMotion, true);\r\n    }\r\n  }\r\n\r\n  stop(): void {\r\n    if (typeof window !== 'undefined') {\r\n      window.removeEventListener('deviceorientation', this.handleOrientation, true);\r\n      window.removeEventListener('devicemotion', this.handleMotion, true);\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}