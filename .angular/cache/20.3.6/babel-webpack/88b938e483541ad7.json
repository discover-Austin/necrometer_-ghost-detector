{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/grand/necrometer_-ghost-detector-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { inject, signal, effect } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DeviceStateService } from '../../services/device-state.service';\nimport { SensorService } from '../../services/sensor.service';\nimport { UpgradeService } from '../../services/upgrade.service';\nimport { GeminiService } from '../../services/gemini.service';\nimport { CameraPreview } from '@capacitor-community/camera-preview';\nimport { App } from '@capacitor/app';\nimport { AudioService } from '../../services/audio.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nconst _forTrack0 = ($index, $item) => $item.id;\nfunction VisionComponent_Conditional_37_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵdomElementStart(0, \"div\", 24);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵdomElementStart(1, \"svg\", 31);\n    i0.ɵɵdomElement(2, \"path\", 32);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵdomElementStart(3, \"h2\", 33);\n    i0.ɵɵtext(4, \"Camera Access Required\");\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(5, \"p\", 34);\n    i0.ɵɵtext(6);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵdomElementStart(7, \"button\", 35);\n    i0.ɵɵdomListener(\"click\", function VisionComponent_Conditional_37_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.startCamera());\n    });\n    i0.ɵɵtext(8, \" RETRY LINK \");\n    i0.ɵɵdomElementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r1.cameraPermissionError());\n  }\n}\nfunction VisionComponent_Conditional_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \" SCANNING... \");\n  }\n}\nfunction VisionComponent_Conditional_43_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵtextInterpolate1(\" SCAN [\", ctx_r1.scanCost, \" NC] \");\n  }\n}\nfunction VisionComponent_Conditional_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"p\", 29);\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.scanError());\n  }\n}\nfunction VisionComponent_For_46_Conditional_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 41);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵdomElementStart(1, \"svg\", 42);\n    i0.ɵɵdomElement(2, \"circle\", 43)(3, \"rect\", 44)(4, \"rect\", 45)(5, \"rect\", 46)(6, \"rect\", 47);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵdomElementStart(7, \"div\", 48);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"uppercase\");\n    i0.ɵɵdomElement(10, \"br\");\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"uppercase\");\n    i0.ɵɵdomElementEnd()();\n  }\n  if (rf & 2) {\n    const entity_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate1(\" TYPE: \", i0.ɵɵpipeBind1(9, 2, entity_r3.type));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" STR: \", i0.ɵɵpipeBind1(12, 4, entity_r3.strength), \" \");\n  }\n}\nfunction VisionComponent_For_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\", 36)(1, \"div\", 37);\n    i0.ɵɵdomElement(2, \"div\", 38)(3, \"div\", 39)(4, \"div\", 40);\n    i0.ɵɵdomElementEnd();\n    i0.ɵɵconditionalCreate(5, VisionComponent_For_46_Conditional_5_Template, 13, 6, \"div\", 41);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    let tmp_13_0;\n    let tmp_14_0;\n    const entity_r3 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵstyleProp(\"left\", entity_r3.x, \"%\")(\"top\", entity_r3.y, \"%\");\n    i0.ɵɵclassProp(\"contained\", entity_r3.contained)(\"targeted\", ((tmp_13_0 = ctx_r1.targetedEntity()) == null ? null : tmp_13_0.id) === entity_r3.id);\n    i0.ɵɵadvance(5);\n    i0.ɵɵconditional(((tmp_14_0 = ctx_r1.targetedEntity()) == null ? null : tmp_14_0.id) === entity_r3.id ? 5 : -1);\n  }\n}\nexport let VisionComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class VisionComponent {\n    constructor() {\n      this.deviceState = inject(DeviceStateService);\n      this.sensorService = inject(SensorService);\n      this.upgradeService = inject(UpgradeService);\n      this.geminiService = inject(GeminiService);\n      this.audioService = inject(AudioService);\n      this.arEntities = signal([], ...(ngDevMode ? [{\n        debugName: \"arEntities\"\n      }] : []));\n      this.targetedEntity = signal(null, ...(ngDevMode ? [{\n        debugName: \"targetedEntity\"\n      }] : []));\n      this.currentTime = signal(Date.now(), ...(ngDevMode ? [{\n        debugName: \"currentTime\"\n      }] : []));\n      this.isCameraActive = false;\n      this.cameraPermissionError = signal(null, ...(ngDevMode ? [{\n        debugName: \"cameraPermissionError\"\n      }] : []));\n      this.appStateListener = null;\n      this.isScanningEnvironment = signal(false, ...(ngDevMode ? [{\n        debugName: \"isScanningEnvironment\"\n      }] : []));\n      this.scanError = signal(null, ...(ngDevMode ? [{\n        debugName: \"scanError\"\n      }] : []));\n      this.sceneObjects = signal([], ...(ngDevMode ? [{\n        debugName: \"sceneObjects\"\n      }] : []));\n      this.scanCost = 5;\n      this.animationFrameId = null;\n      this.physics = {\n        gravityTilt: 0.00005,\n        downwardDrift: 0.00002,\n        friction: 0.97,\n        emfAgitation: 0.00015,\n        maxSpeed: 0.2,\n        sceneRepulsion: 0.0001,\n        sceneRepulsionRadius: 12\n      };\n      effect(() => {\n        this.currentTime();\n      });\n    }\n    ngOnInit() {\n      this.startCamera();\n      this.startAnimationLoop();\n      this.appStateListener = App.addListener('appStateChange', ({\n        isActive\n      }) => {\n        if (isActive && this.cameraPermissionError() && !this.isCameraActive) {\n          this.startCamera();\n        }\n      });\n    }\n    ngOnDestroy() {\n      this.stopCamera();\n      this.stopAnimationLoop();\n      if (this.appStateListener) {\n        this.appStateListener.remove();\n      }\n    }\n    ngOnChanges(changes) {\n      if (changes['detections']) {\n        this.syncDetectionsToAREntities();\n      }\n    }\n    startCamera() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.isCameraActive) return;\n        try {\n          yield CameraPreview.start({\n            position: 'rear',\n            toBack: true,\n            parent: 'vision-camera-container'\n          });\n          _this.isCameraActive = true;\n          _this.cameraPermissionError.set(null);\n        } catch (e) {\n          _this.handleCameraError(e);\n        }\n      })();\n    }\n    stopCamera() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this2.isCameraActive) return;\n        _this2.isCameraActive = false;\n        try {\n          yield CameraPreview.stop();\n        } catch (e) {\n          console.warn(\"Could not stop camera preview\", e);\n        }\n      })();\n    }\n    handleCameraError(err) {\n      const errorMessage = err instanceof Error ? err.message : String(err);\n      if (errorMessage.toLowerCase().includes('permission')) {\n        this.cameraPermissionError.set(\"Camera permission denied. Please enable camera access in your device settings.\");\n      } else {\n        this.cameraPermissionError.set(\"Failed to start the camera. Please ensure permissions are granted and try again.\");\n      }\n    }\n    scanEnvironment() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (_this3.isScanningEnvironment() || !_this3.isCameraActive) return;\n        if (!_this3.upgradeService.spendCredits(_this3.scanCost)) {\n          _this3.scanError.set(`Insufficient Credits. Requires ${_this3.scanCost} NC.`);\n          setTimeout(() => _this3.scanError.set(null), 4000);\n          return;\n        }\n        _this3.isScanningEnvironment.set(true);\n        _this3.scanError.set(null);\n        _this3.sceneObjects.set([]);\n        try {\n          const result = yield CameraPreview.capture({\n            quality: 85\n          });\n          const base64Image = result.value;\n          const analysisResult = yield _this3.geminiService.analyzeScene(base64Image);\n          _this3.sceneObjects.set(analysisResult.objects);\n          setTimeout(() => _this3.sceneObjects.set([]), 15000);\n        } catch (err) {\n          console.error('Environment scan failed:', err);\n          _this3.scanError.set('Scene analysis failed. Connection unstable.');\n          _this3.upgradeService.addCredits(_this3.scanCost); // Refund on failure\n          setTimeout(() => _this3.scanError.set(null), 4000);\n        } finally {\n          _this3.isScanningEnvironment.set(false);\n        }\n      })();\n    }\n    syncDetectionsToAREntities() {\n      this.arEntities.update(currentEntities => {\n        const detectionMap = new Map(this.detections.map(d => [d.id, d]));\n        const newEntities = this.detections.filter(d => !currentEntities.some(e => e.id === d.id)).map(d => this.createAREntity(d));\n        return [...currentEntities.filter(e => detectionMap.has(e.id)), ...newEntities];\n      });\n    }\n    createAREntity(detection) {\n      return {\n        ...detection,\n        x: Math.random() * 90 + 5,\n        y: Math.random() * 90 + 5,\n        vx: (Math.random() - 0.5) * 0.05,\n        vy: (Math.random() - 0.5) * 0.05,\n        ax: 0,\n        ay: 0\n      };\n    }\n    startAnimationLoop() {\n      const animate = () => {\n        this.updateAREntities();\n        this.animationFrameId = requestAnimationFrame(animate);\n      };\n      animate();\n    }\n    stopAnimationLoop() {\n      if (this.animationFrameId) {\n        cancelAnimationFrame(this.animationFrameId);\n      }\n    }\n    updateAREntities() {\n      const orientation = this.sensorService.orientation();\n      const gravityX = orientation ? orientation.gamma / 90 : 0;\n      const gravityY = orientation ? Math.max(-90, Math.min(90, orientation.beta)) / 90 : 0;\n      this.arEntities.update(entities => {\n        let closestEntity = null;\n        let minDistance = 15;\n        const updatedEntities = entities.map(e => {\n          let {\n            x,\n            y,\n            vx,\n            vy,\n            ax,\n            ay\n          } = e;\n          if (e.contained) {\n            vx *= 0.9;\n            vy *= 0.9;\n            x += vx;\n            y += vy;\n            return {\n              ...e,\n              x,\n              y,\n              vx,\n              vy\n            };\n          }\n          ax = gravityX * this.physics.gravityTilt;\n          ay = gravityY * this.physics.gravityTilt + this.physics.downwardDrift;\n          const agitation = this.deviceState.emfReading() * this.physics.emfAgitation;\n          ax += (Math.random() - 0.5) * agitation;\n          ay += (Math.random() - 0.5) * agitation;\n          vx += ax;\n          vy += ay;\n          vx *= this.physics.friction;\n          vy *= this.physics.friction;\n          const speed = Math.sqrt(vx * vx + vy * vy);\n          if (speed > this.physics.maxSpeed) {\n            vx = vx / speed * this.physics.maxSpeed;\n            vy = vy / speed * this.physics.maxSpeed;\n          }\n          x += vx;\n          y += vy;\n          if (y > 105 || x < -5 || x > 105) {\n            x = Math.random() * 80 + 10;\n            y = -5;\n            vx = (Math.random() - 0.5) * 0.02;\n            vy = Math.random() * 0.05;\n          }\n          const updatedEntity = {\n            ...e,\n            x,\n            y,\n            vx,\n            vy,\n            ax,\n            ay\n          };\n          const distanceToCenter = Math.sqrt(Math.pow(updatedEntity.x - 50, 2) + Math.pow(updatedEntity.y - 45, 2));\n          if (distanceToCenter < minDistance) {\n            minDistance = distanceToCenter;\n            closestEntity = updatedEntity;\n          }\n          return updatedEntity;\n        });\n        this.targetedEntity.set(closestEntity);\n        return updatedEntities;\n      });\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function VisionComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || VisionComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: VisionComponent,\n      selectors: [[\"app-vision\"]],\n      inputs: {\n        detections: \"detections\"\n      },\n      features: [i0.ɵɵNgOnChangesFeature],\n      decls: 47,\n      vars: 8,\n      consts: [[\"id\", \"vision-camera-container\", 1, \"relative\", \"w-full\", \"h-full\", \"bg-black\", \"overflow-hidden\", \"font-mono\", \"text-xs\"], [1, \"absolute\", \"inset-0\", \"z-20\", \"pointer-events-none\", \"mix-blend-color-dodge\", \"opacity-40\", \"bg-green-900\"], [1, \"absolute\", \"inset-0\", \"z-20\", \"pointer-events-none\", \"opacity-20\", 2, \"background\", \"repeating-linear-gradient(0deg, transparent 0px, transparent 2px, #0f0 3px)\"], [1, \"absolute\", \"inset-0\", \"z-20\", \"pointer-events-none\", \"text-green-500/10\", \"animate-pulse-slow\", 2, \"background\", \"radial-gradient(circle at center, transparent 30%, #002200 100%)\"], [1, \"absolute\", \"inset-0\", \"z-30\", \"pointer-events-none\", \"p-4\", \"flex\", \"flex-col\", \"justify-between\"], [1, \"flex\", \"justify-between\", \"items-start\"], [1, \"flex\", \"flex-col\", \"gap-1\", \"text-green-500/80\"], [1, \"tracking-[0.2em]\"], [1, \"flex\", \"flex-col\", \"items-end\", \"gap-1\", \"text-green-500/80\"], [1, \"text-xl\", \"font-bold\"], [1, \"absolute\", \"inset-0\", \"flex\", \"items-center\", \"justify-center\", \"opacity-40\"], [\"width\", \"200\", \"height\", \"200\", \"viewBox\", \"0 0 100 100\", \"fill\", \"none\", \"stroke\", \"#22c55e\", \"stroke-width\", \"0.5\"], [\"x1\", \"10\", \"y1\", \"50\", \"x2\", \"40\", \"y2\", \"50\"], [\"x1\", \"60\", \"y1\", \"50\", \"x2\", \"90\", \"y2\", \"50\"], [\"x1\", \"50\", \"y1\", \"10\", \"x2\", \"50\", \"y2\", \"40\"], [\"x1\", \"50\", \"y1\", \"60\", \"x2\", \"50\", \"y2\", \"90\"], [\"cx\", \"50\", \"cy\", \"50\", \"r\", \"2\", \"fill\", \"#22c55e\"], [\"cx\", \"50\", \"cy\", \"50\", \"r\", \"30\", \"stroke-dasharray\", \"5 5\"], [1, \"flex\", \"justify-between\", \"items-end\"], [\"viewBox\", \"0 0 50 50\", \"fill\", \"none\", \"stroke\", \"currentColor\", 1, \"absolute\", \"bottom-4\", \"left-4\", \"w-12\", \"h-12\", \"text-green-500/50\"], [\"d\", \"M0 0 V50 H50\", \"stroke-width\", \"2\"], [\"viewBox\", \"0 0 50 50\", \"fill\", \"none\", \"stroke\", \"currentColor\", 1, \"absolute\", \"bottom-4\", \"right-4\", \"w-12\", \"h-12\", \"text-green-500/50\"], [\"d\", \"M50 0 V50 H0\", \"stroke-width\", \"2\"], [1, \"w-full\", \"text-center\", \"text-green-500/60\", \"pb-2\"], [1, \"absolute\", \"inset-0\", \"z-50\", \"flex\", \"flex-col\", \"items-center\", \"justify-center\", \"bg-black/90\", \"p-8\", \"text-center\"], [1, \"absolute\", \"inset-0\", \"z-10\", \"pointer-events-none\"], [1, \"absolute\", \"top-16\", \"right-4\", \"z-40\", \"flex\", \"flex-col\", \"items-end\", \"gap-2\", \"pointer-events-auto\"], [1, \"px-4\", \"py-2\", \"bg-green-900/50\", \"hover:bg-green-800/60\", \"text-green-300\", \"border\", \"border-green-500/50\", \"backdrop-blur-sm\", \"rounded\", \"font-mono\", \"transition-all\", \"disabled:opacity-50\", \"flex\", \"items-center\", \"gap-2\", \"group\", 3, \"click\", \"disabled\"], [1, \"group-hover:animate-pulse\"], [1, \"text-[10px]\", \"bg-red-900/80\", \"text-red-200\", \"px-2\", \"py-1\", \"border\", \"border-red-500/50\"], [1, \"ar-entity\", 3, \"left\", \"top\", \"contained\", \"targeted\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke-width\", \"1.5\", \"stroke\", \"currentColor\", 1, \"w-16\", \"h-16\", \"text-red-500\", \"mb-4\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z\"], [1, \"text-2xl\", \"font-bold\", \"text-red-400\", \"mb-2\"], [1, \"text-gray-300\", \"mb-6\"], [1, \"px-6\", \"py-3\", \"bg-green-700\", \"hover:bg-green-600\", \"text-white\", \"font-bold\", \"rounded-lg\", \"transition-colors\", \"border\", \"border-green-500/50\", 3, \"click\"], [1, \"ar-entity\"], [1, \"ghost-figure\"], [1, \"ghost-head\"], [1, \"ghost-body\"], [1, \"ghost-tail\"], [1, \"targeting-reticle\"], [\"viewBox\", \"0 0 100 100\"], [\"cx\", \"50\", \"cy\", \"50\", \"r\", \"45\", \"stroke\", \"#ef4444\", 1, \"reticle-circle\"], [\"x\", \"48\", \"y\", \"0\", \"width\", \"4\", \"height\", \"15\", \"fill\", \"#ef4444\"], [\"x\", \"48\", \"y\", \"85\", \"width\", \"4\", \"height\", \"15\", \"fill\", \"#ef4444\"], [\"x\", \"0\", \"y\", \"48\", \"width\", \"15\", \"height\", \"4\", \"fill\", \"#ef4444\"], [\"x\", \"85\", \"y\", \"48\", \"width\", \"15\", \"height\", \"4\", \"fill\", \"#ef4444\"], [1, \"text-xs\", \"text-red-500\", \"font-mono\", \"text-center\", \"mt-2\", \"bg-black/50\", \"px-1\"]],\n      template: function VisionComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵdomElementStart(0, \"div\", 0);\n          i0.ɵɵdomElement(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3);\n          i0.ɵɵdomElementStart(4, \"div\", 4)(5, \"div\", 5)(6, \"div\", 6)(7, \"span\", 7);\n          i0.ɵɵtext(8, \"REC \\u2022 [LIVE]\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(9, \"span\");\n          i0.ɵɵtext(10, \"ISO: 3200\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(11, \"span\");\n          i0.ɵɵtext(12, \"EXP: +1.2\");\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵdomElementStart(13, \"div\", 8)(14, \"span\", 9);\n          i0.ɵɵtext(15);\n          i0.ɵɵpipe(16, \"number\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(17, \"span\");\n          i0.ɵɵtext(18, \"LAT: 33.1204 N\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(19, \"span\");\n          i0.ɵɵtext(20, \"LON: 114.2301 W\");\n          i0.ɵɵdomElementEnd()()();\n          i0.ɵɵdomElementStart(21, \"div\", 10);\n          i0.ɵɵnamespaceSVG();\n          i0.ɵɵdomElementStart(22, \"svg\", 11);\n          i0.ɵɵdomElement(23, \"line\", 12)(24, \"line\", 13)(25, \"line\", 14)(26, \"line\", 15)(27, \"circle\", 16)(28, \"circle\", 17);\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵnamespaceHTML();\n          i0.ɵɵdomElementStart(29, \"div\", 18);\n          i0.ɵɵnamespaceSVG();\n          i0.ɵɵdomElementStart(30, \"svg\", 19);\n          i0.ɵɵdomElement(31, \"path\", 20);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(32, \"svg\", 21);\n          i0.ɵɵdomElement(33, \"path\", 22);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵnamespaceHTML();\n          i0.ɵɵdomElementStart(34, \"div\", 23)(35, \"span\");\n          i0.ɵɵtext(36, \"TARGETING SYSTEM ACTIVE\");\n          i0.ɵɵdomElementEnd()()()();\n          i0.ɵɵconditionalCreate(37, VisionComponent_Conditional_37_Template, 9, 1, \"div\", 24);\n          i0.ɵɵdomElementStart(38, \"div\", 25)(39, \"div\", 26)(40, \"button\", 27);\n          i0.ɵɵdomListener(\"click\", function VisionComponent_Template_button_click_40_listener() {\n            return ctx.scanEnvironment();\n          });\n          i0.ɵɵdomElementStart(41, \"span\", 28);\n          i0.ɵɵconditionalCreate(42, VisionComponent_Conditional_42_Template, 1, 0)(43, VisionComponent_Conditional_43_Template, 1, 1);\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵconditionalCreate(44, VisionComponent_Conditional_44_Template, 2, 1, \"p\", 29);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵrepeaterCreate(45, VisionComponent_For_46_Template, 6, 9, \"div\", 30, _forTrack0);\n          i0.ɵɵdomElementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(15);\n          i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(16, 5, ctx.deviceState.emfReading(), \"1.1-1\"), \" \\u00B5T\");\n          i0.ɵɵadvance(22);\n          i0.ɵɵconditional(ctx.cameraPermissionError() ? 37 : -1);\n          i0.ɵɵadvance(3);\n          i0.ɵɵdomProperty(\"disabled\", ctx.isScanningEnvironment());\n          i0.ɵɵadvance(2);\n          i0.ɵɵconditional(ctx.isScanningEnvironment() ? 42 : 43);\n          i0.ɵɵadvance(2);\n          i0.ɵɵconditional(ctx.scanError() ? 44 : -1);\n          i0.ɵɵadvance();\n          i0.ɵɵrepeater(ctx.arEntities());\n        }\n      },\n      dependencies: [CommonModule, i1.UpperCasePipe, i1.DecimalPipe],\n      styles: [\"[_nghost-%COMP%] {\\n  display: block;\\n  width: 100%;\\n  height: 100%;\\n  background-color: transparent;\\n}\\n\\n.ar-entity[_ngcontent-%COMP%] {\\n  position: absolute;\\n  width: 60px;\\n  height: 80px;\\n  will-change: transform, opacity;\\n  transition: opacity 0.5s;\\n}\\n\\n.ghost-figure[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  filter: drop-shadow(0 0 10px rgba(13, 227, 255, 0.7)) blur(1.5px);\\n  animation: _ngcontent-%COMP%_float 6s ease-in-out infinite;\\n  transform-origin: bottom center;\\n}\\n\\n.ar-entity.targeted[_ngcontent-%COMP%]   .ghost-figure[_ngcontent-%COMP%] {\\n  filter: drop-shadow(0 0 15px rgb(255, 17, 0)) blur(1px);\\n}\\n\\n.ghost-head[_ngcontent-%COMP%] {\\n  width: 60%;\\n  height: 45%;\\n  background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(200,240,255,0.5) 70%);\\n  border-radius: 50% 50% 40% 40% / 60% 60% 40% 40%;\\n  position: relative;\\n  left: 20%;\\n}\\n\\n.ghost-body[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 55%;\\n  background: linear-gradient(to bottom, rgba(200,240,255,0.5), rgba(150,220,255,0.2));\\n  border-radius: 40% 40% 0 0;\\n  position: absolute;\\n  top: 30%;\\n}\\n\\n.ghost-tail[_ngcontent-%COMP%] {\\n  position: absolute;\\n  bottom: -10px;\\n  left: 0;\\n  width: 100%;\\n  height: 20px;\\n  background: rgba(150,220,255,0.2);\\n  border-radius: 0 0 50% 50%;\\n  filter: blur(3px);\\n  animation: _ngcontent-%COMP%_tail-sway 3s ease-in-out infinite;\\n}\\n\\n@keyframes _ngcontent-%COMP%_float {\\n  0%, 100% { transform: translateY(0) rotate(-2deg); }\\n  50% { transform: translateY(-15px) rotate(2deg); }\\n}\\n\\n@keyframes _ngcontent-%COMP%_tail-sway {\\n  0%, 100% { transform: translateX(-5px) scaleX(0.9); }\\n  50% { transform: translateX(5px) scaleX(1.1); }\\n}\\n\\n\\n\\n.targeting-reticle[_ngcontent-%COMP%] {\\n  position: absolute;\\n  top: -20%; left: -20%;\\n  width: 140%;\\n  height: 140%;\\n  animation: _ngcontent-%COMP%_spin 8s linear infinite;\\n}\\n\\n.reticle-circle[_ngcontent-%COMP%] {\\n  stroke: rgba(255, 0, 0, 0.7);\\n  stroke-width: 2;\\n  fill: none;\\n  stroke-dasharray: 10 5;\\n  animation: _ngcontent-%COMP%_pulse-reticle 2s infinite ease-in-out;\\n}\\n\\n@keyframes _ngcontent-%COMP%_spin {\\n  from { transform: rotate(0deg); }\\n  to { transform: rotate(360deg); }\\n}\\n\\n@keyframes _ngcontent-%COMP%_pulse-reticle {\\n  0%, 100% { stroke-width: 2; opacity: 0.7; }\\n  50% { stroke-width: 4; opacity: 1; }\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9jb21wb25lbnRzL3Zpc2lvbi92aXNpb24uY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGNBQWM7RUFDZCxXQUFXO0VBQ1gsWUFBWTtFQUNaLDZCQUE2QjtBQUMvQjs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixXQUFXO0VBQ1gsWUFBWTtFQUNaLCtCQUErQjtFQUMvQix3QkFBd0I7QUFDMUI7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsWUFBWTtFQUNaLGlFQUFpRTtFQUNqRSx3Q0FBd0M7RUFDeEMsK0JBQStCO0FBQ2pDOztBQUVBO0VBQ0UsdURBQXVEO0FBQ3pEOztBQUVBO0VBQ0UsVUFBVTtFQUNWLFdBQVc7RUFDWCx3RkFBd0Y7RUFDeEYsZ0RBQWdEO0VBQ2hELGtCQUFrQjtFQUNsQixTQUFTO0FBQ1g7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsV0FBVztFQUNYLG9GQUFvRjtFQUNwRiwwQkFBMEI7RUFDMUIsa0JBQWtCO0VBQ2xCLFFBQVE7QUFDVjs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixhQUFhO0VBQ2IsT0FBTztFQUNQLFdBQVc7RUFDWCxZQUFZO0VBQ1osaUNBQWlDO0VBQ2pDLDBCQUEwQjtFQUMxQixpQkFBaUI7RUFDakIsNENBQTRDO0FBQzlDOztBQUVBO0VBQ0UsV0FBVyxzQ0FBc0MsRUFBRTtFQUNuRCxNQUFNLHlDQUF5QyxFQUFFO0FBQ25EOztBQUVBO0VBQ0UsV0FBVyx1Q0FBdUMsRUFBRTtFQUNwRCxNQUFNLHNDQUFzQyxFQUFFO0FBQ2hEOztBQUVBLHNCQUFzQjtBQUN0QjtFQUNFLGtCQUFrQjtFQUNsQixTQUFTLEVBQUUsVUFBVTtFQUNyQixXQUFXO0VBQ1gsWUFBWTtFQUNaLGtDQUFrQztBQUNwQzs7QUFFQTtFQUNFLDRCQUE0QjtFQUM1QixlQUFlO0VBQ2YsVUFBVTtFQUNWLHNCQUFzQjtFQUN0QixnREFBZ0Q7QUFDbEQ7O0FBRUE7RUFDRSxPQUFPLHVCQUF1QixFQUFFO0VBQ2hDLEtBQUsseUJBQXlCLEVBQUU7QUFDbEM7O0FBRUE7RUFDRSxXQUFXLGVBQWUsRUFBRSxZQUFZLEVBQUU7RUFDMUMsTUFBTSxlQUFlLEVBQUUsVUFBVSxFQUFFO0FBQ3JDIiwic291cmNlc0NvbnRlbnQiOlsiOmhvc3Qge1xuICBkaXNwbGF5OiBibG9jaztcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG59XG5cbi5hci1lbnRpdHkge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHdpZHRoOiA2MHB4O1xuICBoZWlnaHQ6IDgwcHg7XG4gIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHk7XG4gIHRyYW5zaXRpb246IG9wYWNpdHkgMC41cztcbn1cblxuLmdob3N0LWZpZ3VyZSB7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG4gIGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDEwcHggcmdiYSgxMywgMjI3LCAyNTUsIDAuNykpIGJsdXIoMS41cHgpO1xuICBhbmltYXRpb246IGZsb2F0IDZzIGVhc2UtaW4tb3V0IGluZmluaXRlO1xuICB0cmFuc2Zvcm0tb3JpZ2luOiBib3R0b20gY2VudGVyO1xufVxuXG4uYXItZW50aXR5LnRhcmdldGVkIC5naG9zdC1maWd1cmUge1xuICBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAxNXB4IHJnYigyNTUsIDE3LCAwKSkgYmx1cigxcHgpO1xufVxuXG4uZ2hvc3QtaGVhZCB7XG4gIHdpZHRoOiA2MCU7XG4gIGhlaWdodDogNDUlO1xuICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCByZ2JhKDI1NSwyNTUsMjU1LDAuOCkgMCUsIHJnYmEoMjAwLDI0MCwyNTUsMC41KSA3MCUpO1xuICBib3JkZXItcmFkaXVzOiA1MCUgNTAlIDQwJSA0MCUgLyA2MCUgNjAlIDQwJSA0MCU7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgbGVmdDogMjAlO1xufVxuXG4uZ2hvc3QtYm9keSB7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDU1JTtcbiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgcmdiYSgyMDAsMjQwLDI1NSwwLjUpLCByZ2JhKDE1MCwyMjAsMjU1LDAuMikpO1xuICBib3JkZXItcmFkaXVzOiA0MCUgNDAlIDAgMDtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IDMwJTtcbn1cblxuLmdob3N0LXRhaWwge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGJvdHRvbTogLTEwcHg7XG4gIGxlZnQ6IDA7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDIwcHg7XG4gIGJhY2tncm91bmQ6IHJnYmEoMTUwLDIyMCwyNTUsMC4yKTtcbiAgYm9yZGVyLXJhZGl1czogMCAwIDUwJSA1MCU7XG4gIGZpbHRlcjogYmx1cigzcHgpO1xuICBhbmltYXRpb246IHRhaWwtc3dheSAzcyBlYXNlLWluLW91dCBpbmZpbml0ZTtcbn1cblxuQGtleWZyYW1lcyBmbG9hdCB7XG4gIDAlLCAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHJvdGF0ZSgtMmRlZyk7IH1cbiAgNTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xNXB4KSByb3RhdGUoMmRlZyk7IH1cbn1cblxuQGtleWZyYW1lcyB0YWlsLXN3YXkge1xuICAwJSwgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNXB4KSBzY2FsZVgoMC45KTsgfVxuICA1MCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoNXB4KSBzY2FsZVgoMS4xKTsgfVxufVxuXG4vKiBUYXJnZXRpbmcgUmV0aWNsZSAqL1xuLnRhcmdldGluZy1yZXRpY2xlIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IC0yMCU7IGxlZnQ6IC0yMCU7XG4gIHdpZHRoOiAxNDAlO1xuICBoZWlnaHQ6IDE0MCU7XG4gIGFuaW1hdGlvbjogc3BpbiA4cyBsaW5lYXIgaW5maW5pdGU7XG59XG5cbi5yZXRpY2xlLWNpcmNsZSB7XG4gIHN0cm9rZTogcmdiYSgyNTUsIDAsIDAsIDAuNyk7XG4gIHN0cm9rZS13aWR0aDogMjtcbiAgZmlsbDogbm9uZTtcbiAgc3Ryb2tlLWRhc2hhcnJheTogMTAgNTtcbiAgYW5pbWF0aW9uOiBwdWxzZS1yZXRpY2xlIDJzIGluZmluaXRlIGVhc2UtaW4tb3V0O1xufVxuXG5Aa2V5ZnJhbWVzIHNwaW4ge1xuICBmcm9tIHsgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7IH1cbiAgdG8geyB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyB9XG59XG5cbkBrZXlmcmFtZXMgcHVsc2UtcmV0aWNsZSB7XG4gIDAlLCAxMDAlIHsgc3Ryb2tlLXdpZHRoOiAyOyBvcGFjaXR5OiAwLjc7IH1cbiAgNTAlIHsgc3Ryb2tlLXdpZHRoOiA0OyBvcGFjaXR5OiAxOyB9XG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"],\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return VisionComponent;\n})();","map":{"version":3,"names":["inject","signal","effect","CommonModule","DeviceStateService","SensorService","UpgradeService","GeminiService","CameraPreview","App","AudioService","i0","ɵɵdomElementStart","ɵɵdomElement","ɵɵdomElementEnd","ɵɵtext","ɵɵdomListener","VisionComponent_Conditional_37_Template_button_click_7_listener","ɵɵrestoreView","_r1","ctx_r1","ɵɵnextContext","ɵɵresetView","startCamera","ɵɵadvance","ɵɵtextInterpolate","cameraPermissionError","ɵɵtextInterpolate1","scanCost","scanError","ɵɵpipeBind1","entity_r3","type","strength","ɵɵconditionalCreate","VisionComponent_For_46_Conditional_5_Template","ɵɵstyleProp","x","y","ɵɵclassProp","contained","tmp_13_0","targetedEntity","id","ɵɵconditional","tmp_14_0","VisionComponent","_staticBlock","constructor","deviceState","sensorService","upgradeService","geminiService","audioService","arEntities","ngDevMode","debugName","currentTime","Date","now","isCameraActive","appStateListener","isScanningEnvironment","sceneObjects","animationFrameId","physics","gravityTilt","downwardDrift","friction","emfAgitation","maxSpeed","sceneRepulsion","sceneRepulsionRadius","ngOnInit","startAnimationLoop","addListener","isActive","ngOnDestroy","stopCamera","stopAnimationLoop","remove","ngOnChanges","changes","syncDetectionsToAREntities","_this","_asyncToGenerator","start","position","toBack","parent","set","e","handleCameraError","_this2","stop","console","warn","err","errorMessage","Error","message","String","toLowerCase","includes","scanEnvironment","_this3","spendCredits","setTimeout","result","capture","quality","base64Image","value","analysisResult","analyzeScene","objects","error","addCredits","update","currentEntities","detectionMap","Map","detections","map","d","newEntities","filter","some","createAREntity","has","detection","Math","random","vx","vy","ax","ay","animate","updateAREntities","requestAnimationFrame","cancelAnimationFrame","orientation","gravityX","gamma","gravityY","max","min","beta","entities","closestEntity","minDistance","updatedEntities","agitation","emfReading","speed","sqrt","updatedEntity","distanceToCenter","pow","_","selectors","inputs","features","ɵɵNgOnChangesFeature","decls","vars","consts","template","VisionComponent_Template","rf","ctx","VisionComponent_Conditional_37_Template","VisionComponent_Template_button_click_40_listener","VisionComponent_Conditional_42_Template","VisionComponent_Conditional_43_Template","VisionComponent_Conditional_44_Template","ɵɵrepeaterCreate","VisionComponent_For_46_Template","_forTrack0","ɵɵpipeBind2","ɵɵdomProperty","ɵɵrepeater","i1","UpperCasePipe","DecimalPipe","styles","changeDetection"],"sources":["C:\\Users\\grand\\necrometer_-ghost-detector-1\\src\\components\\vision\\vision.component.ts","C:\\Users\\grand\\necrometer_-ghost-detector-1\\src\\components\\vision\\vision.component.html"],"sourcesContent":["import { Component, ChangeDetectionStrategy, inject, signal, effect, OnDestroy, OnInit, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DeviceStateService } from '../../services/device-state.service';\nimport { DetectedEntity, AREntity, SceneObject } from '../../types';\nimport { SensorService } from '../../services/sensor.service';\nimport { UpgradeService } from '../../services/upgrade.service';\nimport { GeminiService } from '../../services/gemini.service';\nimport { CameraPreview } from '@capacitor-community/camera-preview';\nimport { App } from '@capacitor/app';\nimport { PluginListenerHandle } from '@capacitor/core';\nimport { AudioService } from '../../services/audio.service';\nimport { findNearestAnchor, computeOcclusionLevel } from '../../utils/ar-utils';\n\n@Component({\n  selector: 'app-vision',\n  imports: [CommonModule],\n  templateUrl: './vision.component.html',\n  styleUrls: ['./vision.component.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class VisionComponent implements OnInit, OnDestroy, OnChanges {\n  @Input() detections!: DetectedEntity[];\n  deviceState = inject(DeviceStateService);\n  private sensorService = inject(SensorService);\n  private upgradeService = inject(UpgradeService);\n  private geminiService = inject(GeminiService);\n  private audioService = inject(AudioService);\n\n  arEntities = signal<AREntity[]>([]);\n  targetedEntity = signal<AREntity | null>(null);\n  currentTime = signal(Date.now());\n\n  isCameraActive = false;\n  cameraPermissionError = signal<string | null>(null);\n  private appStateListener: any | null = null;\n\n  isScanningEnvironment = signal(false);\n  scanError = signal<string | null>(null);\n  sceneObjects = signal<SceneObject[]>([]);\n  readonly scanCost = 5;\n\n  private animationFrameId: number | null = null;\n  private physics = {\n    gravityTilt: 0.00005,\n    downwardDrift: 0.00002,\n    friction: 0.97,\n    emfAgitation: 0.00015,\n    maxSpeed: 0.2,\n    sceneRepulsion: 0.0001,\n    sceneRepulsionRadius: 12,\n  };\n\n  constructor() {\n    effect(() => {\n      this.currentTime();\n    });\n  }\n\n  ngOnInit() {\n    this.startCamera();\n    this.startAnimationLoop();\n    this.appStateListener = App.addListener('appStateChange', ({ isActive }) => {\n      if (isActive && this.cameraPermissionError() && !this.isCameraActive) {\n        this.startCamera();\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.stopCamera();\n    this.stopAnimationLoop();\n    if (this.appStateListener) {\n      this.appStateListener.remove();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes['detections']) {\n      this.syncDetectionsToAREntities();\n    }\n  }\n\n  async startCamera() {\n    if (this.isCameraActive) return;\n    try {\n      await CameraPreview.start({\n        position: 'rear',\n        toBack: true,\n        parent: 'vision-camera-container',\n      });\n      this.isCameraActive = true;\n      this.cameraPermissionError.set(null);\n    } catch (e) {\n      this.handleCameraError(e);\n    }\n  }\n\n  async stopCamera() {\n    if (!this.isCameraActive) return;\n    this.isCameraActive = false;\n    try {\n      await CameraPreview.stop();\n    } catch (e) {\n      console.warn(\"Could not stop camera preview\", e);\n    }\n  }\n\n  private handleCameraError(err: unknown) {\n    const errorMessage = err instanceof Error ? err.message : String(err);\n    if (errorMessage.toLowerCase().includes('permission')) {\n      this.cameraPermissionError.set(\"Camera permission denied. Please enable camera access in your device settings.\");\n    } else {\n      this.cameraPermissionError.set(\"Failed to start the camera. Please ensure permissions are granted and try again.\");\n    }\n  }\n\n  async scanEnvironment() {\n    if (this.isScanningEnvironment() || !this.isCameraActive) return;\n\n    if (!this.upgradeService.spendCredits(this.scanCost)) {\n      this.scanError.set(`Insufficient Credits. Requires ${this.scanCost} NC.`);\n      setTimeout(() => this.scanError.set(null), 4000);\n      return;\n    }\n\n    this.isScanningEnvironment.set(true);\n    this.scanError.set(null);\n    this.sceneObjects.set([]);\n\n    try {\n      const result = await CameraPreview.capture({ quality: 85 });\n      const base64Image = (result as any).value;\n      const analysisResult = await this.geminiService.analyzeScene(base64Image);\n      this.sceneObjects.set(analysisResult.objects);\n      setTimeout(() => this.sceneObjects.set([]), 15000);\n    } catch (err) {\n      console.error('Environment scan failed:', err);\n      this.scanError.set('Scene analysis failed. Connection unstable.');\n      this.upgradeService.addCredits(this.scanCost); // Refund on failure\n      setTimeout(() => this.scanError.set(null), 4000);\n    } finally {\n      this.isScanningEnvironment.set(false);\n    }\n  }\n\n  private syncDetectionsToAREntities() {\n    this.arEntities.update(currentEntities => {\n      const detectionMap = new Map(this.detections.map(d => [d.id, d]));\n      const newEntities = this.detections\n        .filter(d => !currentEntities.some(e => e.id === d.id))\n        .map(d => this.createAREntity(d));\n      \n      return [\n        ...currentEntities.filter(e => detectionMap.has(e.id)),\n        ...newEntities\n      ];\n    });\n  }\n\n  private createAREntity(detection: DetectedEntity): AREntity {\n    return {\n      ...detection,\n      x: Math.random() * 90 + 5,\n      y: Math.random() * 90 + 5,\n      vx: (Math.random() - 0.5) * 0.05,\n      vy: (Math.random() - 0.5) * 0.05,\n      ax: 0,\n      ay: 0,\n    };\n  }\n\n  private startAnimationLoop() {\n    const animate = () => {\n      this.updateAREntities();\n      this.animationFrameId = requestAnimationFrame(animate);\n    };\n    animate();\n  }\n\n  private stopAnimationLoop() {\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n  }\n\n  private updateAREntities() {\n    const orientation = this.sensorService.orientation();\n    const gravityX = orientation ? (orientation.gamma / 90) : 0;\n    const gravityY = orientation ? (Math.max(-90, Math.min(90, orientation.beta)) / 90) : 0;\n\n    this.arEntities.update(entities => {\n      let closestEntity: AREntity | null = null;\n      let minDistance = 15;\n\n      const updatedEntities = entities.map(e => {\n        let { x, y, vx, vy, ax, ay } = e;\n\n        if (e.contained) {\n          vx *= 0.9;\n          vy *= 0.9;\n          x += vx;\n          y += vy;\n          return { ...e, x, y, vx, vy };\n        }\n\n        ax = gravityX * this.physics.gravityTilt;\n        ay = gravityY * this.physics.gravityTilt + this.physics.downwardDrift;\n\n        const agitation = this.deviceState.emfReading() * this.physics.emfAgitation;\n        ax += (Math.random() - 0.5) * agitation;\n        ay += (Math.random() - 0.5) * agitation;\n\n        vx += ax;\n        vy += ay;\n        vx *= this.physics.friction;\n        vy *= this.physics.friction;\n\n        const speed = Math.sqrt(vx * vx + vy * vy);\n        if (speed > this.physics.maxSpeed) {\n          vx = (vx / speed) * this.physics.maxSpeed;\n          vy = (vy / speed) * this.physics.maxSpeed;\n        }\n\n        x += vx;\n        y += vy;\n\n        if (y > 105 || x < -5 || x > 105) {\n          x = Math.random() * 80 + 10;\n          y = -5;\n          vx = (Math.random() - 0.5) * 0.02;\n          vy = Math.random() * 0.05;\n        }\n\n        const updatedEntity = { ...e, x, y, vx, vy, ax, ay };\n\n        const distanceToCenter = Math.sqrt(Math.pow(updatedEntity.x - 50, 2) + Math.pow(updatedEntity.y - 45, 2));\n        if (distanceToCenter < minDistance) {\n          minDistance = distanceToCenter;\n          closestEntity = updatedEntity;\n        }\n\n        return updatedEntity;\n      });\n\n      this.targetedEntity.set(closestEntity);\n      return updatedEntities;\n    });\n  }\n}","<div id=\"vision-camera-container\" class=\"relative w-full h-full bg-black overflow-hidden font-mono text-xs\">\r\n\r\n  <!-- Night Vision Filter Overlay -->\r\n  <div class=\"absolute inset-0 z-20 pointer-events-none mix-blend-color-dodge opacity-40 bg-green-900\"></div>\r\n  <div class=\"absolute inset-0 z-20 pointer-events-none opacity-20\"\r\n    style=\"background: repeating-linear-gradient(0deg, transparent 0px, transparent 2px, #0f0 3px);\"></div>\r\n  <div class=\"absolute inset-0 z-20 pointer-events-none text-green-500/10 animate-pulse-slow\"\r\n    style=\"background: radial-gradient(circle at center, transparent 30%, #002200 100%);\"></div>\r\n\r\n  <!-- HUD Layer -->\r\n  <div class=\"absolute inset-0 z-30 pointer-events-none p-4 flex flex-col justify-between\">\r\n\r\n    <!-- Top HUD -->\r\n    <div class=\"flex justify-between items-start\">\r\n      <div class=\"flex flex-col gap-1 text-green-500/80\">\r\n        <span class=\"tracking-[0.2em]\">REC • [LIVE]</span>\r\n        <span>ISO: 3200</span>\r\n        <span>EXP: +1.2</span>\r\n      </div>\r\n      <div class=\"flex flex-col items-end gap-1 text-green-500/80\">\r\n        <span class=\"text-xl font-bold\">{{ deviceState.emfReading() | number:'1.1-1' }} µT</span>\r\n        <span>LAT: 33.1204 N</span>\r\n        <span>LON: 114.2301 W</span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Center Crosshair -->\r\n    <div class=\"absolute inset-0 flex items-center justify-center opacity-40\">\r\n      <svg width=\"200\" height=\"200\" viewBox=\"0 0 100 100\" fill=\"none\" stroke=\"#22c55e\" stroke-width=\"0.5\">\r\n        <line x1=\"10\" y1=\"50\" x2=\"40\" y2=\"50\" />\r\n        <line x1=\"60\" y1=\"50\" x2=\"90\" y2=\"50\" />\r\n        <line x1=\"50\" y1=\"10\" x2=\"50\" y2=\"40\" />\r\n        <line x1=\"50\" y1=\"60\" x2=\"50\" y2=\"90\" />\r\n        <circle cx=\"50\" cy=\"50\" r=\"2\" fill=\"#22c55e\" />\r\n        <circle cx=\"50\" cy=\"50\" r=\"30\" stroke-dasharray=\"5 5\" />\r\n      </svg>\r\n    </div>\r\n\r\n    <!-- Bottom HUD -->\r\n    <div class=\"flex justify-between items-end\">\r\n      <!-- Corner Markers -->\r\n      <svg class=\"absolute bottom-4 left-4 w-12 h-12 text-green-500/50\" viewBox=\"0 0 50 50\" fill=\"none\"\r\n        stroke=\"currentColor\">\r\n        <path d=\"M0 0 V50 H50\" stroke-width=\"2\" />\r\n      </svg>\r\n      <svg class=\"absolute bottom-4 right-4 w-12 h-12 text-green-500/50\" viewBox=\"0 0 50 50\" fill=\"none\"\r\n        stroke=\"currentColor\">\r\n        <path d=\"M50 0 V50 H0\" stroke-width=\"2\" />\r\n      </svg>\r\n\r\n      <div class=\"w-full text-center text-green-500/60 pb-2\">\r\n        <span>TARGETING SYSTEM ACTIVE</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Camera Permission Error Overlay -->\r\n  @if (cameraPermissionError()) {\r\n  <div class=\"absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/90 p-8 text-center\">\r\n    <svg class=\"w-16 h-16 text-red-500 mb-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"\r\n      stroke-width=\"1.5\" stroke=\"currentColor\">\r\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\"\r\n        d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z\" />\r\n    </svg>\r\n    <h2 class=\"text-2xl font-bold text-red-400 mb-2\">Camera Access Required</h2>\r\n    <p class=\"text-gray-300 mb-6\">{{ cameraPermissionError() }}</p>\r\n    <button (click)=\"startCamera()\"\r\n      class=\"px-6 py-3 bg-green-700 hover:bg-green-600 text-white font-bold rounded-lg transition-colors border border-green-500/50\">\r\n      RETRY LINK\r\n    </button>\r\n  </div>\r\n  }\r\n\r\n  <!-- AR Overlay -->\r\n  <div class=\"absolute inset-0 z-10 pointer-events-none\">\r\n    <!-- Scan button and status -->\r\n    <div class=\"absolute top-16 right-4 z-40 flex flex-col items-end gap-2 pointer-events-auto\">\r\n      <button (click)=\"scanEnvironment()\" [disabled]=\"isScanningEnvironment()\"\r\n        class=\"px-4 py-2 bg-green-900/50 hover:bg-green-800/60 text-green-300 border border-green-500/50 backdrop-blur-sm rounded font-mono transition-all disabled:opacity-50 flex items-center gap-2 group\">\r\n        <span class=\"group-hover:animate-pulse\">\r\n          @if (isScanningEnvironment()) {\r\n          SCANNING...\r\n          } @else {\r\n          SCAN [{{ scanCost }} NC]\r\n          }\r\n        </span>\r\n      </button>\r\n      @if (scanError()) {\r\n      <p class=\"text-[10px] bg-red-900/80 text-red-200 px-2 py-1 border border-red-500/50\">{{ scanError() }}</p>\r\n      }\r\n    </div>\r\n\r\n    <!-- AR Entities -->\r\n    @for (entity of arEntities(); track entity.id) {\r\n    <div class=\"ar-entity\" [style.left.%]=\"entity.x\" [style.top.%]=\"entity.y\" [class.contained]=\"entity.contained\"\r\n      [class.targeted]=\"targetedEntity()?.id === entity.id\">\r\n      <div class=\"ghost-figure\">\r\n        <div class=\"ghost-head\"></div>\r\n        <div class=\"ghost-body\"></div>\r\n        <div class=\"ghost-tail\"></div>\r\n      </div>\r\n      @if (targetedEntity()?.id === entity.id) {\r\n      <div class=\"targeting-reticle\">\r\n        <svg viewBox=\"0 0 100 100\">\r\n          <circle class=\"reticle-circle\" cx=\"50\" cy=\"50\" r=\"45\" stroke=\"#ef4444\" />\r\n          <rect x=\"48\" y=\"0\" width=\"4\" height=\"15\" fill=\"#ef4444\" />\r\n          <rect x=\"48\" y=\"85\" width=\"4\" height=\"15\" fill=\"#ef4444\" />\r\n          <rect x=\"0\" y=\"48\" width=\"15\" height=\"4\" fill=\"#ef4444\" />\r\n          <rect x=\"85\" y=\"48\" width=\"15\" height=\"4\" fill=\"#ef4444\" />\r\n        </svg>\r\n        <div class=\"text-xs text-red-500 font-mono text-center mt-2 bg-black/50 px-1\">\r\n          TYPE: {{ entity.type | uppercase }}<br>\r\n          STR: {{ entity.strength | uppercase }}\r\n        </div>\r\n      </div>\r\n      }\r\n    </div>\r\n    }\r\n  </div>\r\n</div>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}