<div
  class="relative flex flex-col items-center justify-around h-full text-center p-2 rounded-lg bg-gray-800/20 border-2 border-[var(--color-primary-500)]/20 transition-all duration-300 pulsating-container"
  [style]="scannerContainerStyles()">

  <div class="absolute inset-0 distortion-overlay pointer-events-none" [style.opacity]="backgroundDistortionOpacity()"></div>

  <div class="w-full max-w-xs space-y-4 z-10">
    <!-- Session & Network Status Bar -->
    @if (sessionInfo()) {
      <div class="flex justify-between items-center text-xs bg-black/40 border border-[var(--color-primary-500)]/20 rounded px-3 py-2">
        <div class="text-left">
          <div class="text-gray-400">Session</div>
          <div class="text-[var(--color-primary-300)] font-mono">{{ sessionInfo()!.duration }}</div>
        </div>
        <div class="text-center">
          <div class="text-gray-400">Detections</div>
          <div class="text-[var(--color-primary-300)] font-bold">{{ sessionInfo()!.detectionCount }}</div>
        </div>
        <div class="text-right">
          <div class="text-gray-400">Network</div>
          <div [class]="networkStatusClass()" class="font-semibold">{{ networkStatus() }}</div>
        </div>
      </div>
    }

    <!-- Status Display -->
    <div>
      <p class="text-sm text-gray-400 uppercase tracking-widest">System Status</p>
      <p class="text-lg font-bold tracking-wider" [class]="statusColorClass()">{{ status() }}</p>
    </div>

    <!-- Main EMF Reading -->
    <div class="relative w-full h-24 flex items-center justify-center">
      <div class="scanline-overlay"></div>
      <p class="font-mono text-6xl font-bold text-[var(--color-primary-300)] z-10 drop-shadow-[0_0_8px_rgba(110,231,183,0.8)]">
        {{ deviceState.emfReading().toFixed(2) }}
      </p>
      <p class="absolute bottom-4 right-8 font-mono text-lg text-[var(--color-primary-500)] z-10">ÂµT</p>
    </div>

    <!-- Energy Bar -->
    <div class="w-full bg-gray-700/50 rounded-full h-4 border border-gray-600 overflow-hidden">
      <div class="h-full rounded-full transition-all duration-150" 
           [class]="barColorClass()" 
           [style.width.%]="deviceState.emfReading()">
      </div>
    </div>
    
    <div class="flex gap-2 w-full">
        <div class="flex-1">
            <app-geo-triangulator [emfReading]="deviceState.emfReading()"></app-geo-triangulator>
        </div>
        <div class="flex-1">
             <!-- Spectral Map -->
            <app-spectral-map [emfReading]="deviceState.emfReading()"></app-spectral-map>
        </div>
    </div>
   

    <!-- Scan Activity Display -->
    <div class="bg-black/40 border border-[var(--color-primary-500)]/20 rounded px-3 py-2">
      <div class="text-xs text-gray-400 mb-1">Current Activity</div>
      <div class="text-xs text-[var(--color-primary-300)] font-mono leading-relaxed">
        {{ scanActivity() }}
      </div>
    </div>

    <!-- Location Display -->
    <div class="flex items-center justify-center gap-2 text-xs">
      <svg class="w-4 h-4 text-[var(--color-primary-500)]" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
      </svg>
      <span class="text-gray-400 font-mono">{{ locationDisplay() }}</span>
    </div>

    <!-- Informational Text -->
    <div class="text-gray-400 text-xs pt-2">
      <p>Monitoring ambient electromagnetic fields for spectral variance.</p>
      <p class="text-[var(--color-primary-600)] mt-1">Advanced AI-powered entity detection system active</p>
    </div>
  </div>
</div>