<!-- Main container -->
<div
  class="relative flex flex-col min-h-screen w-full bg-obsidian-950 border-x border-spectral-900/50 shadow-2xl shadow-spectral-500/10 overflow-hidden font-sans selection:bg-spectral-500/30">

  <!-- Skip to main content link -->
  <a href="#main-content" 
     (click)="skipToMain(); $event.preventDefault()"
     class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:px-4 focus:py-2 focus:bg-spectral-600 focus:text-white focus:rounded focus:outline-none focus:ring-2 focus:ring-spectral-400">
    Skip to main content
  </a>

  <!-- Global Static/Glitch Overlay -->
  <div class="absolute inset-0 pointer-events-none z-20 vision-overlay mix-blend-overlay"
    style="opacity: 0.05;" aria-hidden="true"></div>
  <div class="scanlines z-50" aria-hidden="true"></div>

  <!-- App UI, positioned above the camera feed and overlays -->
  <div class="relative z-30 flex flex-col h-full transition-all duration-500"
    [class.bg-obsidian-950/80]="activeView() !== 'vision'" [class.backdrop-blur-sm]="activeView() !== 'vision'">

    <!-- Header -->
    <header
      class="h-[72px] shrink-0 px-4 py-3 border-b border-spectral-500/20 bg-obsidian-900/80 backdrop-blur-md flex justify-between items-center z-40 relative overflow-hidden">
      <!-- Glow effect behind header -->
      <div class="absolute top-0 left-1/2 -translate-x-1/2 w-3/4 h-1 bg-spectral-400/50 blur-[4px]" aria-hidden="true"></div>

      <div class="flex flex-col z-10">
        <h1
          class="text-2xl font-bold text-spectral-400 tracking-[0.2em] uppercase font-mono drop-shadow-[0_0_8px_rgba(34,211,238,0.6)]">
          NECROMETER
        </h1>
        <div class="flex items-center gap-2">
          <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse" aria-hidden="true"></span>
          <p class="text-[0.65rem] text-spectral-600 uppercase tracking-widest font-mono">System Active</p>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main 
      id="main-content" 
      #mainContent 
      class="flex-1 min-h-0 relative overflow-y-auto overflow-x-hidden scrollbar-hide"
      tabindex="-1"
      role="main"
      [attr.aria-label]="activeView() === 'vision' ? 'Scanner view' : 'System log view'">
      <!-- Grid Background Pattern -->
      <div class="absolute inset-0 z-0 opacity-[0.03]"
        style="background-image: radial-gradient(#22d3ee 1px, transparent 1px); background-size: 20px 20px;"
        aria-hidden="true">
      </div>

      @if (error()) {
        <div role="alert" class="relative z-10 m-4 p-4 bg-red-900/50 border-l-4 border-red-500 rounded text-red-200">
          <p class="font-mono">{{ error() }}</p>
        </div>
      }

      @if (isLoading()) {
        <div class="relative z-10 flex items-center justify-center h-full" role="status" aria-live="polite">
          <p class="text-spectral-400 font-mono">Loading...</p>
        </div>
      }

      <div class="relative z-10 flex flex-col h-full p-4">
        @switch (activeView()) {
        @case ('vision') {
        <app-vision class="flex-1"></app-vision>
        }
        @case ('logbook') {
        <app-logbook 
          class="flex-1" 
          [anomalyEvents]="anomalyService.anomalyEvents()"
          [isLoading]="isLoading()"
          [error]="error()">
        </app-logbook>
        }
        }
      </div>
    </main>

    <!-- Footer / Navigation -->
    <footer class="h-[80px] shrink-0 relative bg-obsidian-950/90 backdrop-blur-xl border-t border-spectral-500/20 z-50">

      <!-- Tab Bar -->
      <nav 
        class="flex justify-around items-center h-full px-2" 
        role="tablist" 
        aria-label="Main navigation">

        <!-- Vision (Primary Scanner) -->
        <button 
          (click)="viewScanner()"
          (keydown)="onNavigationKeydown($event, 'vision')"
          class="group relative flex flex-col items-center justify-center w-14 h-14 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-spectral-400 focus:ring-offset-2 focus:ring-offset-obsidian-950"
          [class.bg-spectral-500/10]="activeView() === 'vision'"
          role="tab"
          [attr.aria-selected]="activeView() === 'vision'"
          [attr.aria-controls]="'main-content'"
          [attr.tabindex]="activeView() === 'vision' ? 0 : -1"
          aria-label="Scanner view">
          <div
            class="absolute inset-0 bg-spectral-400/20 blur-md rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"
            aria-hidden="true">
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 z-10 transition-colors duration-300"
            [class.text-spectral-300]="activeView() === 'vision'" [class.text-slate-500]="activeView() !== 'vision'"
            fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
          <span class="text-[0.6rem] uppercase tracking-wider mt-1 font-mono transition-colors duration-300"
            [class.text-spectral-400]="activeView() === 'vision'"
            [class.text-slate-600]="activeView() !== 'vision'">Scan</span>
        </button>

        <!-- Logbook (Central) -->
        <button 
          (click)="viewLogbook()" 
          (keydown)="onNavigationKeydown($event, 'logbook')"
          class="relative -top-6 focus:outline-none focus:ring-2 focus:ring-spectral-400 focus:ring-offset-2 focus:ring-offset-obsidian-950 rounded-full"
          role="tab"
          [attr.aria-selected]="activeView() === 'logbook'"
          [attr.aria-controls]="'main-content'"
          [attr.tabindex]="activeView() === 'logbook' ? 0 : -1"
          aria-label="System logs">
          <div
            class="w-16 h-16 rounded-full bg-obsidian-900 border-2 border-spectral-500/50 flex items-center justify-center shadow-[0_0_15px_rgba(6,182,212,0.3)] group hover:scale-105 transition-transform duration-300">
            @if (hasNewDetections()) {
            <span
              class="absolute top-0 right-0 w-4 h-4 bg-red-500 rounded-full border-2 border-obsidian-900 animate-pulse z-20"
              role="status"
              aria-label="New detections available"></span>
            }
            <div class="absolute inset-0 rounded-full bg-spectral-500/10 animate-pulse-slow" aria-hidden="true"></div>
            <svg xmlns="http://www.w3.org/2000/svg"
              class="h-7 w-7 text-spectral-300 group-hover:text-spectral-100 transition-colors" fill="none"
              viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
          </div>
          <span
            class="text-[0.6rem] uppercase tracking-wider mt-1 font-mono text-spectral-400 absolute -bottom-5 left-1/2 -translate-x-1/2">Logs</span>
        </button>

      </nav>
    </footer>
  </div>
</div>

<!-- Toast Notifications -->
<app-toast></app-toast>