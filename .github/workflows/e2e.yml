name: E2E / Integration (optional)

on:
  workflow_dispatch:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  e2e-live:
    runs-on: ubuntu-latest
    if: ${{ secrets.GENAI_API_KEY != '' }}
    steps:
      - uses: actions/checkout@v4
+      - name: Setup Node.js
+        uses: actions/setup-node@v4
+        with:
+          node-version: '20'
+      - name: Install
+        run: |
+          npm ci
+          cd server && npm ci
+      - name: Start server (background)
+        run: |
+          cd server
+          nohup node index.js &
+      - name: Run live integration tests
+        run: |
+          cd server
+          GENAI_API_KEY=${{ secrets.GENAI_API_KEY }} npm test --silent -- tests/live.integration.test.js
+        env:
+          API_KEY: ${{ secrets.GENAI_API_KEY }}
+          JWT_ISSUER_SECRET: ${{ secrets.JWT_ISSUER_SECRET }}
+          SHARED_ISSUANCE_TOKEN: ${{ secrets.SHARED_ISSUANCE_TOKEN }}
*** End Patch